<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<!-- saved from url=(0095)http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" class="js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. | Аппаратная платформа Arduino</title>
    
<link rel="shortcut icon" href="http://arduino.ru/sites/default/files/framework_favicon.ico" type="image/x-icon">
<meta name="description" content="Предстоит оснащать дом умной электроникой, который будет скоро построен :).">
<meta name="keywords" content="Arduino,контроллер,электроника,плата,конструктор,электротехника,программирование">
<link rel="canonical" href="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino.html">
<meta name="revisit-after" content="1 day">
    <link type="text/css" rel="stylesheet" media="all" href="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/css_2b6fa7b6147f0b51246aa49e5b3df5ff.css">
<link type="text/css" rel="stylesheet" media="print" href="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/css_b3f750061ba5c4d0a83b8e3e5e735fa1.css">
    <script async="" src="http://cse.google.com/adsense/search/async-ads.js"></script><script type="text/javascript" async="" src="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/ga.js"></script><script type="text/javascript" src="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/js_fce1a6d432fc71212f86e7823be6a5ad.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/", "lightbox2": { "rtl": "0", "file_path": "/(\\w\\w/)sites/default/files", "default_image": "/modules/lightbox2/images/brokenimage.jpg", "border_size": 10, "font_color": "000", "box_color": "fff", "top_position": "", "overlay_opacity": "0.8", "overlay_color": "000", "disable_close_click": true, "resize_sequence": 0, "resize_speed": 400, "fade_in_speed": 400, "slide_down_speed": 600, "use_alt_layout": false, "disable_resize": false, "disable_zoom": false, "force_show_nav": false, "show_caption": true, "loop_items": false, "node_link_text": "View Image Details", "node_link_target": false, "image_count": "Image !current of !total", "video_count": "Video !current of !total", "page_count": "Page !current of !total", "lite_press_x_close": "press \x3ca href=\"#\" onclick=\"hideLightbox(); return FALSE;\"\x3e\x3ckbd\x3ex\x3c/kbd\x3e\x3c/a\x3e to close", "download_link_text": "", "enable_login": false, "enable_contact": false, "keys_close": "c x 27", "keys_previous": "p 37", "keys_next": "n 39", "keys_zoom": "z", "keys_play_pause": "32", "display_image_size": "original", "image_node_sizes": "()", "trigger_lightbox_classes": "", "trigger_lightbox_group_classes": "", "trigger_slideshow_classes": "", "trigger_lightframe_classes": "", "trigger_lightframe_group_classes": "", "custom_class_handler": 0, "custom_trigger_classes": "", "disable_for_gallery_lists": true, "disable_for_acidfree_gallery_lists": true, "enable_acidfree_videos": true, "slideshow_interval": 5000, "slideshow_automatic_start": true, "slideshow_automatic_exit": true, "show_play_pause": true, "pause_on_next_click": false, "pause_on_previous_click": true, "loop_slides": false, "iframe_width": 600, "iframe_height": 400, "iframe_border": 1, "enable_video": false }, "syntaxhighlighter": { "clipboard": "/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf" } });
//--><!]]>
</script>
    <!--[if lte IE 7]><link type="text/css" rel="stylesheet" media="all" href="/themes/framework/ie.css" /><![endif]--> <!--If Less Than or Equal (lte) to IE 7-->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-2018649-4']);
      _gaq.push(['_trackPageview']);

      (function() {
         var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

   </script>
  <style type="text/css">.gscb_a{display:inline-block;font:27px/13px arial,sans-serif}.gsst_a .gscb_a{color:#a1b9ed;cursor:pointer}.gsst_a:hover .gscb_a,.gsst_a:focus .gscb_a{color:#36c}.gsst_a{display:inline-block}.gsst_a{cursor:pointer;padding:0 4px}.gsst_a:hover{text-decoration:none!important}.gsst_b{font-size:16px;padding:0 2px;position:relative;user-select:none;-webkit-user-select:none;white-space:nowrap}.gsst_e{opacity:0.55;}.gsst_a:hover .gsst_e,.gsst_a:focus .gsst_e{opacity:0.72;}.gsst_a:active .gsst_e{opacity:1;}.gsst_f{background:white;text-align:left}.gsst_g{background-color:white;border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-webkit-box-shadow:0 2px 4px rgba(0,0,0,0.2);margin:-1px -3px;padding:0 6px}.gsst_h{background-color:white;height:1px;margin-bottom:-1px;position:relative;top:-1px}.gsib_a{width:100%;padding:4px 6px 0}.gsib_a,.gsib_b{vertical-align:top}.gssb_c{border:0;position:absolute;z-index:989}.gssb_e{border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-webkit-box-shadow:0 2px 4px rgba(0,0,0,0.2);cursor:default}.gssb_f{visibility:hidden;white-space:nowrap}.gssb_k{border:0;display:block;position:absolute;top:0;z-index:988}.gsdd_a{border:none!important}.gsq_a{padding:0}.gscsep_a{display:none}.gssb_a{padding:0 7px}.gssb_a,.gssb_a td{white-space:nowrap;overflow:hidden;line-height:22px}#gssb_b{font-size:11px;color:#36c;text-decoration:none}#gssb_b:hover{font-size:11px;color:#36c;text-decoration:underline}.gssb_g{text-align:center;padding:8px 0 7px;position:relative}.gssb_h{font-size:15px;height:28px;margin:0.2em;-webkit-appearance:button}.gssb_i{background:#eee}.gss_ifl{visibility:hidden;padding-left:5px}.gssb_i .gss_ifl{visibility:visible}a.gssb_j{font-size:13px;color:#36c;text-decoration:none;line-height:100%}a.gssb_j:hover{text-decoration:underline}.gssb_l{height:1px;background-color:#e5e5e5}.gssb_m{color:#000;background:#fff}.gsfe_a{border:1px solid #b9b9b9;border-top-color:#a0a0a0;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);}.gsfe_b{border:1px solid #4d90fe;outline:none;box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.3);}.gssb_a{padding:0 7px}.gssb_e{border:0}.gssb_l{margin:5px 0}.gssb_c .gsc-completion-container{position:static}.gssb_c{z-index:5000}.gsc-completion-container table{background:transparent;font-size:inherit;font-family:inherit}.gssb_c > tbody > tr,.gssb_c > tbody > tr > td,.gssb_d,.gssb_d > tbody > tr,.gssb_d > tbody > tr > td,.gssb_e,.gssb_e > tbody > tr,.gssb_e > tbody > tr > td{padding:0;margin:0;border:0}.gssb_a table,.gssb_a table tr,.gssb_a table tr td{padding:0;margin:0;border:0}</style></head>
  <body class="lightbox-processed">
    <!-- Layout -->
    <div class="container"> <!-- add "showgrid" class to display grid -->
  
      <div id="header" class="clearfix">
        <div id="block-block-10" class="block block-block">

  
  <div class="content">
        <div style="width: 250px; float:right; margin-right:50px" id="cse-search-form" dir="ltr"><form class="gsc-search-box" accept-charset="utf-8"><table cellspacing="0" cellpadding="0" class="gsc-search-box"><tbody><tr><td class="gsc-input"><input autocomplete="off" type="text" size="10" class=" gsc-input" name="search" title="поиск" id="gsc-i-id1" dir="ltr" spellcheck="false" style="outline: none; background: url(http://www.google.com/cse/static/ru/google_custom_search_watermark.gif) 0% 50% no-repeat rgb(255, 255, 255);"><input type="hidden" name="bgresponse" id="bgresponse"></td><td class="gsc-search-button"><input type="button" value="Поиск" class="gsc-search-button" title="поиск"></td><td class="gsc-clear-button"><div class="gsc-clear-button" title="удалить результаты">&nbsp;</div></td></tr></tbody></table><table cellspacing="0" cellpadding="0" class="gsc-branding"><tbody><tr><td class="gsc-branding-user-defined"></td><td class="gsc-branding-text"><div class="gsc-branding-text">технология</div></td><td class="gsc-branding-img"><img src="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/small-logo.png" class="gsc-branding-img"></td></tr></tbody></table></form></div>
<script src="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/jsapi" type="text/javascript"></script><script type="text/javascript"> 
  google.load('search', '1', {language : 'ru'});
  google.setOnLoadCallback(function() {
    var customSearchOptions = {};
    var customSearchControl = new google.search.CustomSearchControl(
      '000212414265083961610:_80qtkoe9oo', customSearchOptions);
    customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
    var options = new google.search.DrawOptions();
    options.setSearchFormRoot('cse-search-form');
    customSearchControl.draw('cse', options);
  }, true);
</script><script src="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/saved_resource" type="text/javascript"></script><link href="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/default+ru.css" type="text/css" rel="stylesheet"><script src="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/default+ru.I.js" type="text/javascript"></script><link type="text/css" href="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/default.css" rel="stylesheet">
  </div>

</div>

                  <a href="http://arduino.ru/" title="">
            <img src="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/framework_logo.png" alt="" id="logo">
          </a>
        
        <div id="sitename">
					  
                      <h1><a href="http://arduino.ru/" title="">Arduino.ru</a></h1>
                  </div> <!-- /#sitename -->
      
              </div> <!-- /#header -->

      <div id="nav">
                  <div id="block-menu-primary-links" class="block block-menu">

  
  <div class="content">
        <ul class="menu"><li class="leaf first even"><a href="http://arduino.ru/About" title="Что такое Ардуино?">Что такое Ардуино?</a></li>
<li class="leaf odd"><a href="http://arduino.ru/Arduino_environment" title="Среда разработки Arduino">Среда разработки</a></li>
<li class="leaf even"><a href="http://arduino.ru/Reference" title="Программирование Ардуино">Программирование</a></li>
<li class="leaf odd"><a href="http://arduino.ru/Hardware" title="Аппартная часть платформы Arduino">Контроллеры Arduino</a></li>
<li class="leaf even"><a href="http://arduino.ru/projects" title="">Проекты</a></li>
<li class="leaf odd"><a href="http://arduino.ru/forum" title="">Форум</a></li>
<li class="leaf last even"><a href="http://arduino.ru/buy" title="">Купить в России</a></li>
</ul>  </div>

</div>
<div id="block-block-11" class="block block-block">

  
  <div class="content">
        <div style="width:100%;" id="cse"><div class="gsc-control-cse gsc-control-cse-ru"><div class="gsc-control-wrapper-cse" dir="ltr"><div class="gsc-results-wrapper-nooverlay"><div class="gsc-tabsAreaInvisible"><div class="gsc-tabHeader gsc-inline-block gsc-tabhActive">Пользовательский поиск</div><span class="gs-spacer"> </span></div><div class="gsc-tabsAreaInvisible"></div><div class="gsc-above-wrapper-area-invisible"><table cellspacing="0" cellpadding="0" class="gsc-above-wrapper-area-container"><tbody><tr><td class="gsc-result-info-container"><div class="gsc-result-info-invisible"></div></td></tr></tbody></table></div><div class="gsc-adBlockInvisible"></div><div class="gsc-wrapper"><div class="gsc-adBlockInvisible"></div><div class="gsc-resultsbox-invisible"><div class="gsc-resultsRoot gsc-tabData gsc-tabdActive"><table cellspacing="0" cellpadding="0" class="gsc-resultsHeader"><tbody><tr><td class="gsc-twiddleRegionCell"><div class="gsc-twiddle"><div class="gsc-title">Интернет</div></div><div class="gsc-stats"></div><div class="gsc-results-selector gsc-all-results-active"><div class="gsc-result-selector gsc-one-result" title="показать один результат">&nbsp;</div><div class="gsc-result-selector gsc-more-results" title="показать другие результаты">&nbsp;</div><div class="gsc-result-selector gsc-all-results" title="показать все результаты">&nbsp;</div></div></td><td class="gsc-configLabelCell"></td></tr></tbody></table><div><div class="gsc-expansionArea"></div></div></div></div></div></div></div></div></div>
  </div>

</div>
        
              </div> <!-- /#nav -->

			
      <div id="main">
        <div class="breadcrumb"><a href="http://arduino.ru/">Главная</a> » <a href="http://arduino.ru/forum">Форумы</a> » <a href="http://arduino.ru/forumy/proekty">Проекты</a></div>                <h2>Передача температуры с датчиков DHT11, DS18B20 через NRF24L01.</h2>                                                

  <div class="forum-topic-header clear-block">
  <a id="top"></a>

  <ul class="forum-links"><li class="comment_forbidden first last"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
</ul>
  <div class="reply-count">
    66 ответов
    
           [<a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01?page=1#comment-46200" class="active">Последнее сообщение</a>]
      </div>
</div>
  
    <div id="node-1326" class="top-post forum-post  clear-block">


  <div class="post-info clear-block">
    <div class="posted-on">
      Ср, 25/04/2012 - 12:35
          </div>

      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        Serega7411      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 06.04.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Предстоит оснащать дом умной электроникой, который будет скоро построен :).</p>
<p>Начал осваивать основы. Пока сделал обмен данными между блоками на ардуино через модуль NRF24L01. Обмен работает через команды и ответы (структуры AS_Command и AS_Answer): один блок посылает другому команду, а тот отвечает ему. Данные о датчиках храняться в стуртуре AS_SensorStatus. Пока сделал передачу данных с подключенных к комнатному блоку DHT11 и DS18B20 на главный блок и отображение главном блоке на 20х4 символьном LCD. Комнатный блок переходит в спящий режим после передачи данных для экономии потребления. Просыпается при получении запроса на NRF24L01, подключен как в примерах&nbsp;MISO -&gt; 12, MOSI -&gt; 11, SCK -&gt; 13, CE -&gt; 8, CSN -&gt; 7, IRQ -&gt; 2.</p>
<p>Сам еще только начинаю осваивать, поэтому комментарии по кривости реализации приветствуются. Работает ли режим энергосбережения пока не знаю, не уверен, но теоретически должен.</p>
<p>Вот файл ASLibrary.h с описанием структур:</p>
<div id="highlighter_54747" class="syntaxhighlighter  "><div class="bar  show"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_54747_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_54747" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="preprocessor">#ifndef __ASLibrary__</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="preprocessor">#define __ASLibrary__</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="preprocessor">#define AS_NRF24L01_payload 5&nbsp;&nbsp; //Максимальный размер буфера в байтах для трансивера NRF24L01</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//должен буть не меньше максимальной длины передаваемых данных</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//и не больше 32 (стркутуры _AS_COMMAND и _AS_ANSWER)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="comments">// Команды состоят из 1 команды и 1 параметра</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="comments">// 1 x - Получить количество датчиков</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="comments">// 2 x - Выполнить измерение по всем датчикам (записать в глобальные переменные, пока не принимать)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="comments">// 3 N - Выполнить измерение по датчику N (записать в глобальные переменные, пока не принимать)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="comments">// 4 N - Получить данные с датчика N (считать из глобальных переменных)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="keyword bold">typedef</code> <code class="keyword bold">struct</code> <code class="plain">_AS_COMMAND</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">byte&nbsp; Command; </code><code class="comments">//Команда</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">byte&nbsp; Parametr; </code><code class="comments">//Параметр</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="plain">}AS_Command;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="comments">// Ответы состоят из 1 статуса и 1 значения</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="comments">// 0 x - Ошибка </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="comments">// 1 N - Данные переданы корректны, N значение</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>25</code></td><td class="content"><code class="keyword bold">typedef</code> <code class="keyword bold">struct</code> <code class="plain">_AS_ANSWER</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>26</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>27</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">byte&nbsp;&nbsp; Status; </code><code class="comments">//Статус</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>28</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="color1 bold">float</code>&nbsp; <code class="plain">Value; </code><code class="comments">//Значение</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>29</code></td><td class="content"><code class="plain">}AS_Answer;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>30</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>31</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>32</code></td><td class="content"><code class="comments">// Состояние датчиков</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>33</code></td><td class="content"><code class="comments">// 0 x - Ошибка </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>34</code></td><td class="content"><code class="comments">// 1 N - Данные актуальны, значение N</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>35</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>36</code></td><td class="content"><code class="keyword bold">typedef</code> <code class="keyword bold">struct</code> <code class="plain">_AS_SENSORSTATUS</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>37</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>38</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">byte&nbsp;&nbsp; Status; </code><code class="comments">//Статус</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>39</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="color1 bold">float</code>&nbsp; <code class="plain">Value; </code><code class="comments">//Значение</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>40</code></td><td class="content"><code class="plain">}AS_SensorStatus;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>41</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>42</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>43</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>44</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>45</code></td><td class="content"><code class="preprocessor">#endif // __ASLibrary__</code></td></tr></tbody></table></div></div></div>

<p>вот скетч приеника (главного бока):</p>
<div id="highlighter_59491" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_59491_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_59491" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>001</code></td><td class="content"><code class="preprocessor">#include &lt;SPI.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>002</code></td><td class="content"><code class="preprocessor">#include &lt;Mirf.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>003</code></td><td class="content"><code class="preprocessor">#include &lt;ASLibrary.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>004</code></td><td class="content"><code class="preprocessor">#include &lt;nRF24L01.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>005</code></td><td class="content"><code class="preprocessor">#include &lt;MirfHardwareSpiDriver.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>006</code></td><td class="content"><code class="preprocessor">#include &lt;LiquidCrystal.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>007</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>008</code></td><td class="content"><code class="comments">// initialize the library with the numbers of the interface pins</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>009</code></td><td class="content"><code class="plain">LiquidCrystal lcd(6, 9, 2, 3, 4, 5);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>010</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>011</code></td><td class="content"><code class="keyword">void</code> <code class="plain">setup(){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>012</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>013</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Serial.begin(9600);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>014</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>015</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.spi = &amp;MirfHardwareSpi;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>016</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.init();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>017</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.setRADDR((</code><code class="keyword">byte</code> <code class="plain">*)</code><code class="string">"main"</code><code class="plain">);</code><code class="comments">// Устанавливаем адрес, под которым будем принимать данные</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>018</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.payload = AS_NRF24L01_payload;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>019</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.config();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>020</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>021</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">lcd.begin(20, 4);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>022</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>023</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">"Beginning ... "</code><code class="plain">); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>024</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>025</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>026</code></td><td class="content"><code class="comments">//Рассчитывает все показания на устройстве с именем addr</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>027</code></td><td class="content"><code class="keyword">byte</code> <code class="plain">CalculateAllParametr(</code><code class="keyword">char</code> <code class="plain">*addr){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>028</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>029</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Command MyCommand; </code><code class="comments">// Команда</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>030</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer&nbsp; MyAnswer;&nbsp; </code><code class="comments">// Ответ</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>031</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">unsigned </code><code class="keyword">long</code> <code class="plain">time;&nbsp;&nbsp; </code><code class="comments">// Время для отслеживания таймаута при запросе данных</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>032</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>033</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.setTADDR((</code><code class="keyword">byte</code> <code class="plain">*)addr); </code><code class="comments">//Устанавливаем адрес, окуда считываем данные</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>034</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>035</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyCommand.Command = 2;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>036</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyCommand.Parametr = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>037</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>038</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.send((</code><code class="keyword">byte</code> <code class="plain">*)&amp;MyCommand);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>039</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">while</code><code class="plain">(Mirf.isSending()){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>040</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>041</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//delay(10);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>042</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">time = millis();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>043</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">while</code><code class="plain">(!Mirf.dataReady()){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>044</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">( ( millis() - time ) &gt; 3000 ) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>045</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">"Timeout on response from server!"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>046</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>047</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>048</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>049</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>050</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.getData((</code><code class="keyword">byte</code> <code class="plain">*) &amp;MyAnswer);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>051</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>052</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(MyAnswer.Status == 0){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>053</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"Error calculate all values on "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>054</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(*addr);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>055</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>056</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>057</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>058</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"Calculate all values OK on "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>059</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(addr);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>060</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>061</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>062</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>063</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>064</code></td><td class="content"><code class="comments">//Получает параметр номер Num с утройства с именем addr</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>065</code></td><td class="content"><code class="keyword">float</code> <code class="plain">GetParametr(</code><code class="keyword">char</code> <code class="plain">*addr, </code><code class="keyword">byte</code> <code class="plain">Num){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>066</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>067</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Command MyCommand; </code><code class="comments">// Команда</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>068</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer&nbsp; MyAnswer;&nbsp; </code><code class="comments">// Ответ</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>069</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">unsigned </code><code class="keyword">long</code> <code class="plain">time;&nbsp;&nbsp; </code><code class="comments">// Время для отслеживания таймаута при запросе данных</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>070</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>071</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.setTADDR((</code><code class="keyword">byte</code> <code class="plain">*)addr);&nbsp; </code><code class="comments">//Устанавливаем адрес, окуда считываем данные</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>072</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>073</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyCommand.Command = 4;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">// Получить данные с датчика N</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>074</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyCommand.Parametr = Num;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>075</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>076</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.send((</code><code class="keyword">byte</code> <code class="plain">*)&amp;MyCommand);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>077</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">while</code><code class="plain">(Mirf.isSending()){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>078</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>079</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//delay(10);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>080</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">time = millis();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>081</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">while</code><code class="plain">(!Mirf.dataReady()){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>082</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">( ( millis() - time ) &gt; 3000 ) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>083</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">"Timeout on response from server!"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>084</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>085</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>086</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>087</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>088</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.getData((</code><code class="keyword">byte</code> <code class="plain">*) &amp;MyAnswer);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>089</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>090</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(MyAnswer.Status == 0){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>091</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"Error when getting data from "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>092</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(addr);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>093</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>094</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>095</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"Get data OK, from: "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>096</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(addr);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>097</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(</code><code class="string">" parametr: "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>098</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(Num);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>099</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">MyAnswer.Value;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>100</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>101</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>102</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>103</code></td><td class="content"><code class="keyword">void</code> <code class="plain">loop(){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>104</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>105</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//AS_SensorStatus h;&nbsp;&nbsp;&nbsp; //Состояние датчика влажности DHT11</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>106</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//AS_SensorStatus t;&nbsp;&nbsp;&nbsp; //Состояние датчика температуры DHT11</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>107</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//AS_SensorStatus ds_t; //Состояние датчика температуры DS18B20</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>108</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">char</code> <code class="plain">*addr = </code><code class="string">"hall"</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>109</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">float</code> <code class="plain">t,t1,h;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>110</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>111</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(CalculateAllParametr(addr) == 1) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>112</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">t = GetParametr(addr, 2);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>113</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"Temperature DS1820: "</code><code class="plain">); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>114</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(t);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>115</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">" *C"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>116</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">t1 = GetParametr(addr, 0);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>117</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"Temperature DHT11: "</code><code class="plain">); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>118</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(t1);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>119</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">" *C"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>120</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">h = GetParametr(addr, 1);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>121</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"Humidity DH11: "</code><code class="plain">); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>122</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(h);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>123</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">" %"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>124</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">""</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>125</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.setCursor(0, 0);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>126</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(</code><code class="string">"Temp DS1820: "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>127</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.setCursor(0, 1);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>128</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(</code><code class="string">"Temp&nbsp; DHT11: "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>129</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.setCursor(0, 2);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>130</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(</code><code class="string">"Humid DHT11: "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>131</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>132</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.setCursor(13, 0);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>133</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(t);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>134</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.setCursor(13, 1);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>135</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(t1);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>136</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.setCursor(13, 2);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>137</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(h);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>138</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>139</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.setCursor(19, 0);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>140</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(</code><code class="string">"C"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>141</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.setCursor(19, 1);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>142</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(</code><code class="string">"C"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>143</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.setCursor(19, 2);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>144</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(</code><code class="string">"%"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>145</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>146</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>147</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>148</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">delay(10);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>149</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>150</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>

<p>Вот скетч передатчика (блока в комнатах):</p>
<div id="highlighter_417106" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_417106_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_417106" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>001</code></td><td class="content"><code class="preprocessor">#include &lt;SPI.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>002</code></td><td class="content"><code class="preprocessor">#include &lt;DHT.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>003</code></td><td class="content"><code class="preprocessor">#include &lt;Mirf.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>004</code></td><td class="content"><code class="preprocessor">#include &lt;ASLibrary.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>005</code></td><td class="content"><code class="preprocessor">#include &lt;MirfHardwareSpiDriver.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>006</code></td><td class="content"><code class="preprocessor">#include &lt;avr/sleep.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>007</code></td><td class="content"><code class="preprocessor">#include &lt;OneWire.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>008</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>009</code></td><td class="content"><code class="plain">AS_SensorStatus MySensors[3];</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>010</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>011</code></td><td class="content"><code class="plain">DHT dht(3, DHT11);&nbsp; </code><code class="comments">//Создаем датчик DHT11 на 3 пине</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>012</code></td><td class="content"><code class="plain">OneWire ds(5);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">//Создаем датчик DS18B20 на 5 пине</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>013</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>014</code></td><td class="content"><code class="keyword">void</code> <code class="plain">wakeupFunction(){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>015</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>016</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>017</code></td><td class="content"><code class="keyword">void</code> <code class="plain">toSleep(){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>018</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">attachInterrupt(0,wakeupFunction,LOW);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>019</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">sleep_mode();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>020</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">detachInterrupt(0);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>021</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>022</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>023</code></td><td class="content"><code class="keyword">void</code> <code class="plain">setup() {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>024</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//Serial.begin(9600); </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>025</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>026</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">dht.begin(); </code><code class="comments">//Инициализируем датчик DHT</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>027</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>028</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MySensors[0].Status = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>029</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MySensors[1].Status = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>030</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MySensors[2].Status = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>031</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>032</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.spi = &amp;MirfHardwareSpi;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>033</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.init();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>034</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.setRADDR((</code><code class="keyword">byte</code> <code class="plain">*)</code><code class="string">"hall"</code><code class="plain">); </code><code class="comments">//Задаем адрес под которым будем принимать данные</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>035</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.payload = AS_NRF24L01_payload; </code><code class="comments">//Задаем размер буфера данных</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>036</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.config(); </code><code class="comments">//Инициализируем модуль NRF24L01</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>037</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>038</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">set_sleep_mode(SLEEP_MODE_PWR_DOWN);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>039</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">sleep_enable();</code><code class="comments">//Переходим в спящий режим</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>040</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>041</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>042</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>043</code></td><td class="content"><code class="comments">//Возвращает значение температуры с датчика 18B20</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>044</code></td><td class="content"><code class="keyword">float</code> <code class="plain">Get_18B20_Data(){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>045</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>046</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">byte</code> <code class="plain">DSdata[2];</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>047</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">ds.reset(); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>048</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">ds.write(0xCC);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>049</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">ds.write(0x44);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>050</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">delay(1000);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>051</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">ds.reset();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>052</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">ds.write(0xCC);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>053</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">ds.write(0xBE);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>054</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">DSdata[0] = ds.read(); </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>055</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">DSdata[1] = ds.read();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>056</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">int</code> <code class="plain">Temp = (DSdata[1] &lt;&lt; 8) + DSdata[0];</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>057</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">(</code><code class="keyword">float</code><code class="plain">) Temp / 16;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>058</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>059</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>060</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>061</code></td><td class="content"><code class="comments">//Вычисляет все данные и заполняет массив значений датчиков</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>062</code></td><td class="content"><code class="keyword">byte</code> <code class="plain">CalculateAllData()</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>063</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>064</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>065</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">float</code> <code class="plain">t, h;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>066</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>067</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">t = dht.readTemperature();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>068</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">h = dht.readHumidity();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>069</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>070</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(isnan(t) || isnan(h)) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>071</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[0].Status = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>072</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[0].Value = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>073</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[1].Status = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>074</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[1].Value = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>075</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>076</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>077</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[0].Status = 1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>078</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[0].Value = t;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>079</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[1].Status = 1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>080</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[1].Value = h;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>081</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>082</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>083</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>084</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MySensors[2].Status = 1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>085</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MySensors[2].Value = Get_18B20_Data();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>086</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>087</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>088</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>089</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>090</code></td><td class="content"><code class="plain">AS_Answer ExecuteCommand(AS_Command MyCommand){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>091</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>092</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer&nbsp; MyAnswer;&nbsp; </code><code class="comments">// Ответ</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>093</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>094</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyAnswer.Value&nbsp; = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>095</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>096</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">switch</code> <code class="plain">(MyCommand.Command) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>097</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">2: </code><code class="comments">//Рассчитать все значения датчиков</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>098</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = CalculateAllData();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>099</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">4: </code><code class="comments">//Получиь значение датчика по номеру</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>100</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = MySensors[MyCommand.Parametr].Status;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>101</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Value&nbsp; = MySensors[MyCommand.Parametr].Value;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>102</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>103</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>104</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">MyAnswer;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>105</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>106</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>107</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>108</code></td><td class="content"><code class="keyword">void</code> <code class="plain">loop() {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>109</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>110</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Command MyCommand; </code><code class="comments">// Команда</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>111</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer&nbsp; MyAnswer;&nbsp; </code><code class="comments">// Ответ</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>112</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>113</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code><code class="plain">(!Mirf.isSending() &amp;&amp; Mirf.dataReady()){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>114</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Serial.println("111");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>115</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Mirf.getData((</code><code class="keyword">byte</code> <code class="plain">*) &amp;MyCommand);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>116</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer = ExecuteCommand(MyCommand);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>117</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Mirf.setTADDR((</code><code class="keyword">byte</code> <code class="plain">*) </code><code class="string">"main"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>118</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Mirf.send((</code><code class="keyword">byte</code> <code class="plain">*) &amp;MyAnswer);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>119</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>120</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>121</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>122</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">/* No data - night night. */</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>123</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">toSleep();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>124</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>125</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>

<p>&nbsp;</p>
<p>&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links inline forum-links"><li class="comment_forbidden first last"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
</ul>      </div>
      </div>
</div><div id="comments"><a id="comment-9129"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Втр, 01/05/2012 - 01:52
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9129" class="active">#1</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>&nbsp;Видимо, делаю что-то похожее ;) предлагаю объединить усилия...&nbsp;</p>
<p>У Вас работает только один приемник и один передатчик? я правильно понял?</p>
<p>я пошел пока малость по другому пути - есть несколько беспроводных блочков (один типа "внешний" (датчик DHT22), другой "внутренний" (соответственно DHT11, RTC)) и пока один приемник (принимать данные и пока их просто гнать в последовательный порт).</p>
<p>Передатчики работают самостоятельно (просто молотят в эфир свои данные в виде форматированных строк). Каждый из них работает в собтвенном режиме (там, где блок RTC - частота посылок около 2Гц, там где датчик DHT22 - одна посылка в 2 минуты).</p>
<p>Приемником пока удается принимать сигналы только одного передатчика, как заставить работать два сразу - пока не придумал:&nbsp;<a href="http://arduino.ru/forum/programmirovanie/nrf24l01#comment-9100" rel="nofollow">http://arduino.ru/forum/programmirovanie/nrf24l01#comment-9100</a></p>
<p>Хотя, если пойти по Вашему пути, то все будет, видимо, проще...&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9155"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Ср, 02/05/2012 - 11:04
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9155" class="active">#2</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        Serega7411      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 06.04.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>&nbsp;</p><div class="quote-msg"><div class="quote-author"><em>ustas</em> пишет:</div><p></p>
<p>Видимо, делаю что-то похожее ;) предлагаю объединить усилия...</p>
<p>У Вас работает только один приемник и один передатчик? я правильно понял?</p>
<p></p></div><p></p>
<p>Не совсем так. У меня на ведущем и на ведомом стоит трансивер, т.е. приемник-передатчик. Ведомое устройство "слушает" эфир, работает на прием. Когда к нему (они имеют свой адреса, например "hall", "Room1") обращается ведущее устройство(имеет имя "Main", работает в этот момент передатчиком) ведомое отрабатывает команду. После отправки команды ведущее устройство переключается на прием и ждет ответ от ведомого. Ведомое получив команду производит действия, и отправляет ответ, переключившись на передачу.&nbsp;<br>
В качестве ведущего пока используется ардуино уно, потом заменю на мегу, т.к. не хватает каналов на все задумки. Сейчас подключены трансивер, дисплей LCD 20х4, 4 кнопки. Еще надо подключить часы, SD карту. Еще думаю надо 485 подключать. <br>
Ведомые сделаны на ардуино нано. Пока реализован 3 команды, которые отрабатываются ведомым при получении команды с ведущего: 1 – Получить количество датчиков, 2 – выполнить измерение по всем датчикам, 4 – получить данные с датчика N. Измерение и получение разделены т.к. некоторые датчики долго отрабатывают  измерение, DS18B20 1 сек измеряет температуру, поэтому производится измерение и записываются в массив показаний датчиков, а потом можно быстро получать несколько раз данные из этого массива.<br>
Дальше планирую добавить команду 3 - измерить данные на датчике N, добавить работу с исполнительными устройствами.</p>
<p>Посмотрел вашу ссылку, если хочется постояно измерять, то можно измерять с нужной периодичностью и записывать в перменные и выдавать данные из переменных по запросу от главного-ведущего устройства. Я же делал измерение по запросу потому что хотел использовать режим пониженого потребления, Нано у меня "засыпает" после передачи данных, просыпается когда приходят запрос на нее. Кстати, DHT11 температуру меряет ужасно, у него погрешность +-2С. Только для влажности их буду использовать раз уж взял. На практике бывает расхождение больше 3С с DS18B20, но он тоже не идеал, может погрешности сложились, надо будет потом несколько штук одновременно подключить и сравнить среднее.</p>
<p>Сейчас дописал примитивные функции для работы с кнопками и менюшками на LCD. Типа по меню кнопками выбираешь Display-hall и выводит на LCD показания датчиков c устройства с именем "hall". Если кому интересно выложу в таком виде. Попозже выложу с работой с исполнительными механизмами, хочу реализовать давюю задумку - автозакрытие закрытие окон если дома светлее чем на улице, автоокрытие по часам (если успеет Мега прийти, а то на часы не осталось каналов) или через меню на LCD, или с универсального пульта по ИК, а то так ломает шторы каждый день открывать - закрывать, пролазия через горшки с цветами. Уже подключил шаговик к Нано через ULN2003, который киндер выковырял из найденной на помойке печ. машинки. Тогда ругался на него, что собирает всякую грязь, а тут пригодился. Осталось механику сделать.</p>
<p>
&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9159"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Ср, 02/05/2012 - 12:34
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9159" class="active">#3</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Сергей, очень интересно! Я только что повторил ваш код и заставил работать его у себя (с соответствующими правками).</p>
<p>Теперь я могу с центрального блока опрашивать все датчики и в том темпе, что мне нужно. А когда заставлю спящий режим работать - так вообще красота будет.</p>
<p>Работает все, за исключением спящего режима. Помогите с ним разобраться?</p>
<p>Вопрос - на какую ногу микроконтроллера у вас идет контакт&nbsp;IRQ от трансивера?</p>
<p>Еще у меня трансиверы есть в двух вариантах: с внешней антенной и без нее.</p>
<p>Вроде как все идентично, но замечено следующее: несмотря на то, модуль по документации толерантен к 5В выходам ардуино (питается, естественно, 3.3В), модули с внешней антенной спокойно работают в 5В режиме.. а вот модули со встроенной антенной работают крайне нестабильно - 2-5 посылок и "вешаемся". При этом, если переключить режим работы с 5В на 3.3В (на сидуинах у меня есть такой переключатель на платке) - все модули работают стабильно (по некольку суток гонял - все работает четко).&nbsp;</p>
<p>Хотелось бы узнать, как Вы подключаете эти модули к своим платкам?</p>
<p>&nbsp;</p>
<p>Про DHT11 хорошо предупредили - тоже сделаю его только датчиком влажности (пару штук купил), а температуру буду спрашивать с&nbsp;DS18B20.</p>
<p>Кстати, есть неплохой датчик DHT22 - работает от -40*С и точность выше существенно (его буду использовать для наружного датчика).</p>
<p>Еще маленькая идейка - подключать часы не к "центральному блоку", а к одному из внутренних (благо, там с "ногами" свободными проблем нет) и использовать их как еще несколько "датчиков" (часы, минуты, секунды, день недели и т.п.). На центральном блоке - только отображать. &nbsp;У себя сейчас так и реализую.</p>
<p>В своей системе я хочу замутить еще управление газовым котлом (термостат) и кондиционером... Еще с женой подумали над системой автоматического полива растений (пока на балконе, дальше - посмотрим).. Аквариум, опять же, пока не автоматизированный ;))) Простую систему управления жалюзи (отдельную) я уже реализовал (вот тут в конце результат:&nbsp;<a href="http://arduino.ru/forum/apparatnye-voprosy/strannost-v-povedenii-kontrollera" rel="nofollow">http://arduino.ru/forum/apparatnye-voprosy/strannost-v-povedenii-kontrollera</a>), правда, требуется доработка...&nbsp;</p>
<p>Спасибо большое за код и направление мысли - ОЧЕНЬ помогло и поставило мозги на место :) Ваш подход несомненно лучше использует железо и более гибко может подстраиваться под логику.</p>
<p>Выкладывайте, что получается :) думаю, не мне одному это интересно.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9161"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Ср, 02/05/2012 - 13:30
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9161" class="active">#4</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        Serega7411      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 06.04.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Питание 3.3 в. беру с ардуино. <br>
Прерывание подключено к 2 цифровому входу (в первом посте указал IRQ -&gt; 2 ).</p>
<p>Most Arduino boards have two external interrupts: numbers 0 (on digital pin 2) and 1 (on digital pin 3)</p>
<p>attachInterrupt(0,wakeupFunction,LOW);</p>
<p>&nbsp;</p>
<p>"0" &nbsp;- соотвественно подключает прерывание по pin 2&nbsp;</p>
<p>
Вообще я хочу на окна поставить рулонные шторы с направлюющими, они почти не заметны на окне. В магизинах пока попадались только без направляющих - такие не нужны. Жалюзи взял т.к. дешевые попались под руку 0.7х1.2 ~400 р., взял пару на "попробовать". Я на жалюзях хочу сделать подЪем и опускание, чтобы полностью убирались. Если делать открытие поворотом, то можно по фоторезистору отслеживать максимальное освещение, т.к. из-за движения солнца оптимальный угол открытия будет меняться. Все равно хотел внутрь и наружу поставить по фоторезистору на каждую комнату.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9175"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Чт, 03/05/2012 - 00:09
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9175" class="active">#5</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>&nbsp;Сергей, а у Вас стабильно работает?</p>
<p>Сегодня с утра, пока "главный модуль" и "дочка" были на столе - все работало нормально.</p>
<p>Днем поставил в более-мнее боевые условия (хотя все-таки в "менее" - всего-то несколько метров между модулями) и получаю массу ошибок "Timeout on response from out1"...&nbsp;</p>
<p>Причем, если я пытаюсь опрашивать по очереди сначала одну "дочку", а затем - вторую, количество ошибок увеличивается (такое ощущение, что модули мешают друг-другу работать.. опрашиваю, правда, при прохождении одного цикла... видимо, надо как-то по времени запросы разделять (как разделять понятно.. просто пока писал - возможно, нашел причину нестабильности)...</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9186"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Чт, 03/05/2012 - 10:41
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9186" class="active">#6</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        Serega7411      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 06.04.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p></p><div class="quote-msg"><div class="quote-author"><em>ustas</em> пишет:</div><p></p>
<p>&nbsp;Сергей, а у Вас стабильно работает?</p>
<p></p></div><p></p>
<p>Пока нет возможности проверить. Основная работа совсем не связанна с электроникой. Это так, хобби. Времени на хобби получается выделить 2-3 часа в неделю, поэтому это дело идет медленно. Может на следующие длинные выходные разберусь как прошивать Atmega и соберу на отдельных МК, протестирую если время выдастся, а то сейчас только 2 МК для отладки - 1 уно и 1 нано.</p>
<p>А мешать друг-другу модули теоретически не должны если они на прием работают. Возможно действительно нужно поставить задержку между опросами.&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9217"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пт, 04/05/2012 - 00:20
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9217" class="active">#7</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Сергей, если будет возможность - попробуйте подольше потестировать (сутки, двое) с периодом опроса 2-5 минут... У меня пока стабильность сильно хромает (и я пока даже не представляю, как найти "узкое" место).</p>
<p>Еще сейчас провожу ревизию Вашего кода - есть некоторые замечания (может, обменяемся контактами, чтобы в личной переписке обсудить?).</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9221"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пт, 04/05/2012 - 03:24
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9221" class="active">#8</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        Zapek@n      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 16.02.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p></p><div class="quote-msg"><div class="quote-author"><em>ustas</em> пишет:</div><p></p>
<p>... чтобы в личной переписке обсудить?).</p>
<p></p></div><p></p>
<p>Не не, нам тоже интересно.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9224"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пт, 04/05/2012 - 09:54
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9224" class="active">#9</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        Serega7411      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 06.04.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p></p><div class="quote-msg"><div class="quote-author"><em>ustas</em> пишет:</div><p></p>
<p>Сергей, если будет возможность - попробуйте подольше потестировать (сутки, двое) с периодом опроса 2-5 минут... У меня пока стабильность сильно хромает (и я пока даже не представляю, как найти "узкое" место).</p>
<p>Еще сейчас провожу ревизию Вашего кода - есть некоторые замечания (может, обменяемся контактами, чтобы в личной переписке обсудить?).</p>
<p></p></div><p></p>
<p>Как время появится, так обязательно подольше потестирую.</p>
<p>Код вполне возможно сильно корявый, я на С уже лет 10 не писал, со времен института. Это так сказать проба пера, то чтос первого раза получилось. Поэтому критика кода приветствуется. Я уже сам нашел несколько косяков, немного поправил всякие указатели, массивы. Но как уже писал, времени катострофически не хватает на хобби, поэтому обновления кода могу делать раз в неделю, не чаще.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9225"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пт, 04/05/2012 - 10:01
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9225" class="active">#10</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>&nbsp;Покажите, что получилось на текущий момент?</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9228"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пт, 04/05/2012 - 12:23
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9228" class="active">#11</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        Serega7411      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 06.04.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Код "Непричесанный", комментариев нет, и т.д., в каком виде был когда оторвали семейные дела от развлечений. Но рабочий.  Добавлена работа с менюшками на LCD, вывод на LCD показаний датчиков из выбранного в меню блока(комнаты). Рассчитано на дисплей 20х4. Выбор пункта меню кнопками - 1 пункт - 1-я кнопка и т.д. Задействованы пока 3 кнопки.</p>
<p>&nbsp;ASLibrary.h</p>
<div id="highlighter_311323" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_311323_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_311323" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="preprocessor">#ifndef __ASLibrary__</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="preprocessor">#define __ASLibrary__</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="preprocessor">#define CommentLen 20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Длина комментария в сообщении</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="preprocessor">#define AS_NRF24L01_payload 25&nbsp; //Максимальный размер буфера в байтах для трансивера NRF24L01</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//должен буть не меньше максимальной длины передаваемых данных</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//и не больше 32 (стркутуры _AS_COMMAND и _AS_ANSWER)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="comments">// Команды состоят из 1 команды и 1 параметра</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="comments">// 1 x - Получить количество датчиков</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="comments">// 2 x - Выполнить измерение по всем датчикам (записать в глобальные переменные, пока не принимать)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="comments">// 3 N - Выполнить измерение по датчику N (записать в глобальные переменные, пока не принимать)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="comments">// 4 N - Получить данные с датчика N (считать из глобальных переменных)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="plain">typedef </code><code class="keyword">struct</code> <code class="plain">_AS_COMMAND</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code>&nbsp; <code class="plain">Command; </code><code class="comments">//Команда</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code>&nbsp; <code class="plain">Parametr; </code><code class="comments">//Параметр</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="plain">}AS_Command;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="comments">// Ответы состоят из 1 статуса и 1 значения</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="comments">// 0 x - Ошибка </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content"><code class="comments">// 1 N - Данные переданы корректны, N значение</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>25</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>26</code></td><td class="content"><code class="plain">typedef </code><code class="keyword">struct</code> <code class="plain">_AS_ANSWER</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>27</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>28</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code>&nbsp;&nbsp; <code class="plain">Status;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">//Статус</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>29</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">float</code>&nbsp; <code class="plain">Value;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">//Значение</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>30</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code>&nbsp;&nbsp; <code class="plain">Comment[CommentLen]; </code><code class="comments">//Описание</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>31</code></td><td class="content"><code class="plain">}AS_Answer;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>32</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>33</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>34</code></td><td class="content"><code class="comments">// Состояние датчиков</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>35</code></td><td class="content"><code class="comments">// 0 x - Ошибка </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>36</code></td><td class="content"><code class="comments">// 1 N - Данные актуальны, значение N</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>37</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>38</code></td><td class="content"><code class="plain">typedef </code><code class="keyword">struct</code> <code class="plain">_AS_SENSORSTATUS</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>39</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>40</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code>&nbsp;&nbsp; <code class="plain">Status; </code><code class="comments">//Статус</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>41</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">float</code>&nbsp; <code class="plain">Value; </code><code class="comments">//Значение</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>42</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code>&nbsp;&nbsp; <code class="plain">Comment[CommentLen]; </code><code class="comments">//Описание</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>43</code></td><td class="content"><code class="plain">}AS_SensorStatus;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>44</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>45</code></td><td class="content"><code class="comments">// Структура пункта меню</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>46</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>47</code></td><td class="content"><code class="plain">typedef </code><code class="keyword">struct</code> <code class="plain">_AS_MENUITEM</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>48</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>49</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">char</code> <code class="plain">*Name;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">//Отображаемая трока</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>50</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code> <code class="plain">Type;&nbsp; </code><code class="comments">//Тип пункта меню</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>51</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//1 - подменю</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>52</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//10 - вывести значения датчиков с устройства, имя устройства дадано именем пункта меню</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>53</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code> <code class="plain">*Menu;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">//Ссылка на меню, на которое нужно перейти при выборе этого пункта</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>54</code></td><td class="content"><code class="plain">}AS_MenuItem;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>55</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>56</code></td><td class="content"><code class="comments">// Структура меню</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>57</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>58</code></td><td class="content"><code class="plain">typedef </code><code class="keyword">struct</code> <code class="plain">_AS_MENU</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>59</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>60</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code> <code class="plain">Count; </code><code class="comments">//Количество пунктов меню</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>61</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">AS_MenuItem *MenuItems;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">//Ссылка на список пунктов меню</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>62</code></td><td class="content"><code class="plain">}AS_Menu;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>63</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>64</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>65</code></td><td class="content"><code class="preprocessor">#endif // __ASLibrary__</code></td></tr></tbody></table></div></div></div>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Ведомый блок</p>
<div id="highlighter_30701" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_30701_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_30701" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>001</code></td><td class="content"><code class="preprocessor">#include &lt;SPI.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>002</code></td><td class="content"><code class="preprocessor">#include &lt;DHT.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>003</code></td><td class="content"><code class="preprocessor">#include &lt;Mirf.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>004</code></td><td class="content"><code class="preprocessor">#include &lt;ASLibrary.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>005</code></td><td class="content"><code class="preprocessor">#include &lt;MirfHardwareSpiDriver.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>006</code></td><td class="content"><code class="preprocessor">#include &lt;avr/sleep.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>007</code></td><td class="content"><code class="preprocessor">#include &lt;OneWire.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>008</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>009</code></td><td class="content"><code class="preprocessor">#define NumSensors 3</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>010</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>011</code></td><td class="content"><code class="plain">AS_SensorStatus MySensors[NumSensors] = {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>012</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">0,0,</code><code class="string">"DHT_temp(C)"</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>013</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">0,0,</code><code class="string">"DHT_hidm(%)"</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>014</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">0,0,</code><code class="string">"DS_temp(C)"</code><code class="plain">};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>015</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>016</code></td><td class="content"><code class="plain">DHT dht(4, DHT11);&nbsp; </code><code class="comments">//Создаем датчик DHT11 на 3 пине</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>017</code></td><td class="content"><code class="plain">OneWire ds(5);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">//Создаем датчик DS18B20 на 5 пине</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>018</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>019</code></td><td class="content"><code class="keyword">void</code> <code class="plain">wakeupFunction(){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>020</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>021</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>022</code></td><td class="content"><code class="keyword">void</code> <code class="plain">toSleep(){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>023</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">attachInterrupt(0,wakeupFunction,LOW);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>024</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">sleep_mode();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>025</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">detachInterrupt(0);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>026</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>027</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>028</code></td><td class="content"><code class="keyword">void</code> <code class="plain">setup() {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>029</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//Serial.begin(9600); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>030</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>031</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">dht.begin(); </code><code class="comments">//Инициализируем датчик DHT</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>032</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>033</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MySensors[0].Status = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>034</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MySensors[1].Status = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>035</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MySensors[2].Status = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>036</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>037</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.spi = &amp;MirfHardwareSpi;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>038</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.init();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>039</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.setRADDR((</code><code class="keyword">byte</code> <code class="plain">*)</code><code class="string">"hall"</code><code class="plain">); </code><code class="comments">//Задаем адрес под которым будем принимать данные</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>040</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.payload = AS_NRF24L01_payload; </code><code class="comments">//Задаем размер буфера данных</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>041</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.config(); </code><code class="comments">//Инициализируем модуль NRF24L01</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>042</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>043</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">set_sleep_mode(SLEEP_MODE_PWR_DOWN);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>044</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">sleep_enable();</code><code class="comments">//Переходим в спящий режим</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>045</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>046</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>047</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>048</code></td><td class="content"><code class="comments">//Возвращает значение температуры с датчика 18B20</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>049</code></td><td class="content"><code class="keyword">float</code> <code class="plain">Get_18B20_Data(){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>050</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>051</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">byte</code> <code class="plain">DSdata[2];</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>052</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">ds.reset(); </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>053</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">ds.write(0xCC);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>054</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">ds.write(0x44);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>055</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">delay(1000);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>056</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">ds.reset();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>057</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">ds.write(0xCC);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>058</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">ds.write(0xBE);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>059</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">DSdata[0] = ds.read(); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>060</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">DSdata[1] = ds.read();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>061</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">int</code> <code class="plain">Temp = (DSdata[1] &lt;&lt; 8) + DSdata[0];</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>062</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">(</code><code class="keyword">float</code><code class="plain">) Temp / 16;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>063</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>064</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>065</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>066</code></td><td class="content"><code class="comments">//Вычисляет все данные и заполняет массив значений датчиков</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>067</code></td><td class="content"><code class="keyword">byte</code> <code class="plain">CalculateAllData()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>068</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>069</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>070</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">float</code> <code class="plain">t, h;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>071</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>072</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">t = dht.readTemperature();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>073</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">h = dht.readHumidity();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>074</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//Serial.print(t);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>075</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//Serial.print(h);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>076</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(isnan(t) || isnan(h)) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>077</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[0].Status = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>078</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[0].Value = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>079</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[1].Status = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>080</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[1].Value = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>081</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>082</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>083</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[0].Status = 1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>084</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[0].Value = t;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>085</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[1].Status = 1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>086</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[1].Value = h;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>087</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>088</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>089</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>090</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MySensors[2].Status = 1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>091</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MySensors[2].Value = Get_18B20_Data();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>092</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//Serial.print(MySensors[2].Value);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>093</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>094</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>095</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>096</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>097</code></td><td class="content"><code class="plain">AS_Answer ExecuteCommand(AS_Command MyCommand){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>098</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>099</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer&nbsp; MyAnswer;&nbsp; </code><code class="comments">// Ответ</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>100</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>101</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyAnswer.Value&nbsp; = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>102</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">char</code> <code class="plain">P[]=</code><code class="string">"Y"</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>103</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>104</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">switch</code> <code class="plain">(MyCommand.Command) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>105</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">1: </code><code class="comments">//Получиь количество датчиков</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>106</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = 1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>107</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Value&nbsp; = NumSensors;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>108</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Serial.println("1.");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>109</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>110</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">2: </code><code class="comments">//Рассчитать все значения датчиков</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>111</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = CalculateAllData();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>112</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="color1">///Serial.println("2.");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>113</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>114</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">4: </code><code class="comments">//Получиь значение датчика по номеру</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>115</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Serial.println("4.");</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>116</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">((MyCommand.Parametr+1) &gt; NumSensors){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>117</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>118</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Value&nbsp; = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>119</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">memcpy(&amp;MyAnswer.Comment,&amp;</code><code class="string">"Too big num par."</code><code class="plain">, CommentLen);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>120</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>121</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>122</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = MySensors[MyCommand.Parametr].Status;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>123</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Value&nbsp; = MySensors[MyCommand.Parametr].Value;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>124</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">memcpy(&amp;MyAnswer.Comment,&amp;MySensors[MyCommand.Parametr].Comment, CommentLen);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>125</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//MyAnswer.Comment[0] = P[0];</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>126</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>127</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>128</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>129</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>130</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">MyAnswer;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>131</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>132</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>133</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>134</code></td><td class="content"><code class="keyword">void</code> <code class="plain">loop() {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>135</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>136</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Command MyCommand; </code><code class="comments">// Команда</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>137</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer&nbsp; MyAnswer;&nbsp; </code><code class="comments">// Ответ</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>138</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>139</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code><code class="plain">(!Mirf.isSending() &amp;&amp; Mirf.dataReady()){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>140</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Serial.println("111");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>141</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Mirf.getData((</code><code class="keyword">byte</code> <code class="plain">*) &amp;MyCommand);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>142</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer = ExecuteCommand(MyCommand);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>143</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Mirf.setTADDR((</code><code class="keyword">byte</code> <code class="plain">*) </code><code class="string">"main"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>144</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">delay(100);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>145</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Mirf.send((</code><code class="keyword">byte</code> <code class="plain">*) &amp;MyAnswer);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>146</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>147</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>148</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>149</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">/* No data - night night. */</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>150</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">toSleep();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>151</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>152</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>

<p>&nbsp;</p>
<p>Ведущий блок</p>
<p>&nbsp;</p>
<div id="highlighter_618983" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_618983_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_618983" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>001</code></td><td class="content"><code class="preprocessor">#include &lt;SPI.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>002</code></td><td class="content"><code class="preprocessor">#include &lt;Mirf.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>003</code></td><td class="content"><code class="preprocessor">#include &lt;ASLibrary.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>004</code></td><td class="content"><code class="preprocessor">#include &lt;nRF24L01.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>005</code></td><td class="content"><code class="preprocessor">#include &lt;MirfHardwareSpiDriver.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>006</code></td><td class="content"><code class="preprocessor">#include &lt;LiquidCrystal.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>007</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>008</code></td><td class="content"><code class="preprocessor">#define button1Pin 14</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>009</code></td><td class="content"><code class="preprocessor">#define button2Pin 15</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>010</code></td><td class="content"><code class="preprocessor">#define button3Pin 16</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>011</code></td><td class="content"><code class="preprocessor">#define button4Pin 17</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>012</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>013</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>014</code></td><td class="content"><code class="comments">// initialize the library with the numbers of the interface pins</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>015</code></td><td class="content"><code class="plain">LiquidCrystal lcd(6, 9, 2, 3, 4, 5);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>016</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>017</code></td><td class="content"><code class="plain">AS_Menu *CurrentMenu;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>018</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>019</code></td><td class="content"><code class="plain">AS_MenuItem SettingMenuItems[3]={</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>020</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="string">"Time"</code><code class="plain">,0,0,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>021</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="string">"Temp"</code><code class="plain">,0,0,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>022</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="string">"Exit"</code><code class="plain">,1,0};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>023</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>024</code></td><td class="content"><code class="plain">AS_Menu SettingMenu = {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>025</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">3, SettingMenuItems};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>026</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>027</code></td><td class="content"><code class="plain">AS_MenuItem DisplayMenuItems[3]={</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>028</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="string">"hall"</code><code class="plain">,10,0,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>029</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="string">"kitchen"</code><code class="plain">,0,0,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>030</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="string">"Exit"</code><code class="plain">,1,0};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>031</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>032</code></td><td class="content"><code class="plain">AS_Menu DisplayMenu = {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>033</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">3, DisplayMenuItems};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>034</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>035</code></td><td class="content"><code class="plain">AS_MenuItem MainMenuItems[2]={</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>036</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="string">"Display"</code><code class="plain">,1,(</code><code class="keyword">byte</code> <code class="plain">*)&amp;DisplayMenu,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>037</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="string">"Setting"</code><code class="plain">,1,(</code><code class="keyword">byte</code> <code class="plain">*)&amp;SettingMenu};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>038</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>039</code></td><td class="content"><code class="plain">AS_Menu MainMenu = {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>040</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">2, MainMenuItems};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>041</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>042</code></td><td class="content"><code class="keyword">void</code> <code class="plain">setup(){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>043</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>044</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Serial.begin(9600);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>045</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>046</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">pinMode(button1Pin, INPUT);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>047</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">pinMode(button2Pin, INPUT);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>048</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">pinMode(button3Pin, INPUT);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>049</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">pinMode(button4Pin, INPUT);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>050</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>051</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.spi = &amp;MirfHardwareSpi;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>052</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.init();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>053</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.setRADDR((</code><code class="keyword">byte</code> <code class="plain">*)</code><code class="string">"main"</code><code class="plain">);</code><code class="comments">// Устанавливаем адрес, под которым будем принимать данные</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>054</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.payload = AS_NRF24L01_payload; </code><code class="comments">//Задаем размер буфера данных</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>055</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.config();</code><code class="comments">//Инициализируем модуль NRF24L01</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>056</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>057</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">lcd.begin(20, 4);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>058</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>059</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">"Beginning ... "</code><code class="plain">); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>060</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//lcd.print("MM0 ");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>061</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//lcd.print((long)&amp;MainMenu);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>062</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">DrawMenu(&amp;MainMenu);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>063</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>064</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>065</code></td><td class="content"><code class="keyword">void</code> <code class="plain">loop(){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>066</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>067</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//char *addr = "hall";</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>068</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">float</code> <code class="plain">t,t1,h;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>069</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">byte</code> <code class="plain">CurrentButton;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>070</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_MenuItem * MI;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>071</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>072</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">CurrentButton = PressedButton();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>073</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>074</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//Serial.print(CurrentButton);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>075</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//lcd.setCursor(0, 2);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>076</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(CurrentButton != 0 ){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>077</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>078</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">((*CurrentMenu).Count &gt;= CurrentButton)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>079</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">{ </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>080</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Serial.print(" k ");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>081</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Serial.print(CurrentButton);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>082</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">switch</code><code class="plain">((*CurrentMenu).MenuItems[CurrentButton-1].Type){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>083</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">10:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>084</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">ShowSensors((*CurrentMenu).MenuItems[CurrentButton-1].Name);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>085</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">1:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>086</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">DrawMenu((AS_Menu *)(*CurrentMenu).MenuItems[CurrentButton-1].Menu);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>087</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>088</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>089</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">// CurrentButton = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>090</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>091</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">delay(200);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>092</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>093</code></td><td class="content"><code class="plain">} </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>094</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>095</code></td><td class="content"><code class="comments">//Получает данные с передатчика и выводит на LCD</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>096</code></td><td class="content"><code class="keyword">void</code> <code class="plain">ShowSensors(</code><code class="keyword">char</code> <code class="plain">* Name){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>097</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">byte</code> <code class="plain">Count=3;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>098</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//char t[]= "tt";</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>099</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer MyAnswer;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>100</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">lcd.clear();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>101</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">lcd.print(</code><code class="string">"Calculate sensor on "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>102</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">lcd.println(Name);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>103</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(CalculateAllParametr(Name) == 1 ){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>104</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.clear();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>105</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(</code><code class="string">"Getting count sensors"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>106</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">delay(10);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>107</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer = GetAnswer(Name, 1, 0);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>108</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(MyAnswer.Status == 1) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>109</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//MyAnswer.Value = 3;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>110</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Count = MyAnswer.Value;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>111</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Serial.println(Count);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>112</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.clear();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>113</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">byte</code> <code class="plain">i=0; i&lt;Count; i++){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>114</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">delay(10);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>115</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer = GetAnswer(Name, 4, i);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>116</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//memcpy(&amp;MyAnswer.Comment,&amp;t, CommentLen);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>117</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code><code class="plain">(i &lt; 4)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>118</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.setCursor(0, i);&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>119</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Serial.println((char *)MyAnswer.Comment);//Выводим номер пункта меню</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>120</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print((</code><code class="keyword">char</code> <code class="plain">*)MyAnswer.Comment);</code><code class="comments">//Выводим номер пункта меню</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>121</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(</code><code class="string">" : "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>122</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(MyAnswer.Value);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>123</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>124</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>125</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>126</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>127</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>128</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.clear();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>129</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.println(</code><code class="string">"Error calculate sensors"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>130</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>131</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">while</code> <code class="plain">(PressedButton() == 0)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>132</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">delay(200);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>133</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">DrawMenu(&amp;MainMenu);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>134</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>135</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>136</code></td><td class="content"><code class="comments">//Выводим меню на дисплей</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>137</code></td><td class="content"><code class="keyword">void</code> <code class="plain">DrawMenu(AS_Menu * Menu) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>138</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">lcd.clear();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>139</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">byte</code> <code class="plain">i=0; i&lt;(*Menu).Count; i++){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>140</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.setCursor(0, i);&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>141</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(i+1);</code><code class="comments">//Выводим номер пункта меню</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>142</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print(</code><code class="string">"."</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>143</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">lcd.print((*Menu).MenuItems[i].Name);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>144</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code><code class="plain">(strcmp((*Menu).MenuItems[i].Name, </code><code class="string">"Exit"</code><code class="plain">) == 0){</code><code class="comments">//Если пункт меню называется "Exit"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>145</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">(*Menu).MenuItems[i].Menu = (</code><code class="keyword">byte</code> <code class="plain">*)CurrentMenu;</code><code class="comments">//то нужно указать, что по этому пункту выход в предыдущее меню</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>146</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Serial.print("MM3 ");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>147</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Serial.print((long)CurrentMenu);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>148</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>149</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>150</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//Serial.print("MM2 ");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>151</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//Serial.println((long)Menu);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>152</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">CurrentMenu = Menu;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>153</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//Serial.print("CM1 ");</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>154</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//Serial.print((long)CurrentMenu);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>155</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>156</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>157</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>158</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>159</code></td><td class="content"><code class="comments">//Рассчитывает все показания на устройстве с именем addr</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>160</code></td><td class="content"><code class="keyword">byte</code> <code class="plain">CalculateAllParametr(</code><code class="keyword">char</code> <code class="plain">*addr){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>161</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>162</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer MyAnswer = GetAnswer(addr, 2, 0);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>163</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>164</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(MyAnswer.Status == 0){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>165</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"Error calculate all values on "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>166</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(*addr);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>167</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>168</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>169</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>170</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"Calculate all values OK on "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>171</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(addr);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>172</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>173</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>174</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>175</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>176</code></td><td class="content"><code class="comments">//Посылает команду на устройство и вовращает ответ</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>177</code></td><td class="content"><code class="plain">AS_Answer GetAnswer(</code><code class="keyword">char</code> <code class="plain">*addr, </code><code class="keyword">byte</code> <code class="plain">Command, </code><code class="keyword">byte</code> <code class="plain">Parametr){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>178</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>179</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Command MyCommand; </code><code class="comments">// Команда</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>180</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer&nbsp; MyAnswer;&nbsp; </code><code class="comments">// Ответ</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>181</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">unsigned </code><code class="keyword">long</code> <code class="plain">time;&nbsp;&nbsp; </code><code class="comments">// Время для отслеживания таймаута при запросе данных</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>182</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>183</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.setTADDR((</code><code class="keyword">byte</code> <code class="plain">*)addr); </code><code class="comments">//Устанавливаем адрес, окуда считываем данные</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>184</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>185</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyCommand.Command = Command;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>186</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyCommand.Parametr = Parametr;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>187</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>188</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.send((</code><code class="keyword">byte</code> <code class="plain">*)&amp;MyCommand);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>189</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">while</code><code class="plain">(Mirf.isSending()){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>190</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>191</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">delay(1000);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>192</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">time = millis();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>193</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">while</code><code class="plain">(!Mirf.dataReady()){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>194</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">( ( millis() - time ) &gt; 1000 ) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>195</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"Timeout on response from "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>196</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(addr);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>197</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>198</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">MyAnswer;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>199</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>200</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>201</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>202</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.getData((</code><code class="keyword">byte</code> <code class="plain">*) &amp;MyAnswer);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>203</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>204</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"Response OK from "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>205</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Serial.println(addr);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>206</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>207</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">MyAnswer;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>208</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>209</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>210</code></td><td class="content"><code class="comments">/*</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>211</code></td><td class="content"><code class="comments">//Получает параметр номер Num с утройства с именем addr</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>212</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">float GetParametr(char *addr, byte Num){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>213</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>214</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">AS_Command MyCommand; // Команда</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>215</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">AS_Answer&nbsp; MyAnswer;&nbsp; // Ответ</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>216</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">unsigned long time;&nbsp;&nbsp; // Время для отслеживания таймаута при запросе данных</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>217</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>218</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">Mirf.setTADDR((byte *)addr);&nbsp; //Устанавливаем адрес, окуда считываем данные</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>219</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>220</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">MyCommand.Command = 4;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Получить данные с датчика N</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>221</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">MyCommand.Parametr = Num;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>222</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>223</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">Mirf.send((byte *)&amp;MyCommand);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>224</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">while(Mirf.isSending()){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>225</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>226</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">//delay(10);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>227</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">time = millis();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>228</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">while(!Mirf.dataReady()){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>229</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">if ( ( millis() - time ) &gt; 3000 ) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>230</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">Serial.println("Timeout on response from server!");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>231</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">return 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>232</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>233</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>234</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>235</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">Mirf.getData((byte *) &amp;MyAnswer);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>236</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>237</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">if (MyAnswer.Status == 0){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>238</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">Serial.print("Error when getting data from ");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>239</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">Serial.println(addr);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>240</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">}&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>241</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">else{&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>242</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">Serial.print("Get data OK, from: ");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>243</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">Serial.print(addr);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>244</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">Serial.print(" parametr: ");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>245</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">Serial.println(Num);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>246</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">return MyAnswer.Value;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>247</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>248</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="comments">}*/</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>249</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>250</code></td><td class="content"><code class="keyword">byte</code> <code class="plain">PressedButton(</code><code class="keyword">void</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>251</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>252</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code><code class="plain">(digitalRead(button1Pin)==HIGH){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>253</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>254</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>255</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>256</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code><code class="plain">(digitalRead(button2Pin)==HIGH){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>257</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">2;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>258</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>259</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>260</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code><code class="plain">(digitalRead(button3Pin)==HIGH){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>261</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">3;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>262</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>263</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>264</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>265</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>266</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>267</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>268</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>

<p>&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9365"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пнд, 07/05/2012 - 00:34
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9365" class="active">#12</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>&nbsp;Сергей, помогите разобраться...&nbsp;</p>
<p>Модифицировал код под себя немного.</p>
<p>Файл&nbsp;ASLibrary1.h (исправлений минимум - добавлен канал, убрал меню):</p>
<div id="highlighter_87642" class="syntaxhighlighter collapsed  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#expandSource" title="показать код" class="item expandSource" style="width: 16px; height: 16px;">показать код</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_87642_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_87642" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="preprocessor">#ifndef __ASLibrary__</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="preprocessor">#define __ASLibrary__</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="preprocessor">#define CommentLen 20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Длина комментария в сообщении</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="preprocessor">#define AS_NRF24L01_payload 5&nbsp;&nbsp; //Максимальный размер буфера в байтах для трансивера NRF24L01</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//должен буть не меньше максимальной длины передаваемых данных</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//и не больше 32 (стркутуры _AS_COMMAND и _AS_ANSWER)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="preprocessor">#define AS_NRF24L01_channel 77&nbsp; //канал, на котором работает трансивер NRF24L01</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//RF Channel 0 - 127 or 0 - 84 in the US, default 0.</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="comments">// Команды состоят из 1 команды и 1 параметра</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="comments">// 0 x - Перезагрузка</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="comments">// 1 x - Получить количество датчиков</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="comments">// 2 x - Выполнить измерение по всем датчикам (записать в глобальные переменные, пока не принимать)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="comments">// 3 N - Выполнить измерение по датчику N (записать в глобальные переменные, пока не принимать)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="comments">// 4 N - Получить данные с датчика N (считать из глобальных переменных)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="plain">typedef </code><code class="keyword">struct</code> <code class="plain">_AS_COMMAND</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code>&nbsp; <code class="plain">Command; </code><code class="comments">//Команда</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code>&nbsp; <code class="plain">Parametr; </code><code class="comments">//Параметр</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="plain">}AS_Command;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>25</code></td><td class="content"><code class="comments">// Ответы состоят из 1 статуса и 1 значения</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>26</code></td><td class="content"><code class="comments">// 0 x - Ошибка </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>27</code></td><td class="content"><code class="comments">// 1 N - Данные переданы корректны, N значение</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>28</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>29</code></td><td class="content"><code class="plain">typedef </code><code class="keyword">struct</code> <code class="plain">_AS_ANSWER</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>30</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>31</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code>&nbsp;&nbsp; <code class="plain">Status; </code><code class="comments">//Статус</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>32</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">float</code>&nbsp; <code class="plain">Value; </code><code class="comments">//Значение</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>33</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code>&nbsp;&nbsp; <code class="plain">Comment[CommentLen]; </code><code class="comments">//Описание</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>34</code></td><td class="content"><code class="plain">}AS_Answer;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>35</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>36</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>37</code></td><td class="content"><code class="comments">// Состояние датчиков</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>38</code></td><td class="content"><code class="comments">// 0 x - Ошибка </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>39</code></td><td class="content"><code class="comments">// 1 N - Данные актуальны, значение N</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>40</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>41</code></td><td class="content"><code class="plain">typedef </code><code class="keyword">struct</code> <code class="plain">_AS_SENSORSTATUS</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>42</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>43</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code>&nbsp;&nbsp; <code class="plain">Status; </code><code class="comments">//Статус</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>44</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">float</code>&nbsp; <code class="plain">Value; </code><code class="comments">//Значение</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>45</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">byte</code>&nbsp;&nbsp; <code class="plain">Comment[CommentLen]; </code><code class="comments">//Описание</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>46</code></td><td class="content"><code class="plain">}AS_SensorStatus;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>47</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>48</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>49</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>50</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>51</code></td><td class="content"><code class="preprocessor">#endif // __ASLibrary__</code></td></tr></tbody></table></div></div></div>

<p>файл для "ведомого" блока (тут тоже минимум изменений - датчик DS заменен на аналоговый, добавлен канал для трансивера, общие команды для трансивера выведены в функцию setup):</p>
<div id="highlighter_161300" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_161300_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_161300" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>001</code></td><td class="content"><code class="preprocessor">#include &lt;SPI.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>002</code></td><td class="content"><code class="preprocessor">#include &lt;DHT.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>003</code></td><td class="content"><code class="preprocessor">#include &lt;Mirf.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>004</code></td><td class="content"><code class="preprocessor">#include &lt;ASLibrary1.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>005</code></td><td class="content"><code class="preprocessor">#include &lt;MirfHardwareSpiDriver.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>006</code></td><td class="content"><code class="preprocessor">#include &lt;avr/sleep.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>007</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>008</code></td><td class="content"><code class="preprocessor">#define NumSensors 3</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>009</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>010</code></td><td class="content"><code class="plain">AS_SensorStatus MySensors[NumSensors] = {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>011</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">0,0,</code><code class="string">"DHT_temp(C)"</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>012</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">0,0,</code><code class="string">"DHT_hidm(%)"</code><code class="plain">,</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>013</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">0,0,</code><code class="string">"Batt_pow(V)"</code><code class="plain">};</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>014</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>015</code></td><td class="content"><code class="plain">DHT dht(6, DHT22);&nbsp; </code><code class="comments">//Создаем датчик DHT22 на 6 пине</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>016</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>017</code></td><td class="content"><code class="keyword">const</code> <code class="keyword">int</code> <code class="plain">analogInPin = A0;&nbsp; </code><code class="comments">// Analog input pin that the VBAT pin is attached to</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>018</code></td><td class="content"><code class="keyword">float</code> <code class="plain">v = 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">// variable for voltage calculation</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>019</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>020</code></td><td class="content"><code class="keyword">void</code> <code class="plain">wakeupFunction(){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>021</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>022</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>023</code></td><td class="content"><code class="keyword">void</code> <code class="plain">toSleep(){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>024</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">attachInterrupt(0,wakeupFunction,LOW);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>025</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">sleep_mode();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>026</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">detachInterrupt(0);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>027</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>028</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>029</code></td><td class="content"><code class="keyword">void</code><code class="plain">(* resetFunc) (</code><code class="keyword">void</code><code class="plain">) = 0; </code><code class="comments">// Reset MC function</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>030</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>031</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>032</code></td><td class="content"><code class="keyword">void</code> <code class="plain">setup() {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>033</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Serial.begin(9600); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>034</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>035</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">dht.begin(); </code><code class="comments">//Инициализируем датчик DHT</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>036</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>037</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">int</code> <code class="plain">i=0; i&lt;NumSensors; i++){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>038</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[i].Status = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>039</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>040</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>041</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.spi = &amp;MirfHardwareSpi;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>042</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.csnPin = 9;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>043</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.cePin = 8;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>044</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.init();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>045</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>046</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.setRADDR((</code><code class="keyword">byte</code> <code class="plain">*)</code><code class="string">"WTHR"</code><code class="plain">); </code><code class="comments">//Задаем адрес под которым будем принимать данные</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>047</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.setTADDR((</code><code class="keyword">byte</code> <code class="plain">*)</code><code class="string">"main"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>048</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>049</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.payload = AS_NRF24L01_payload; </code><code class="comments">//Задаем размер буфера данных</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>050</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.channel = AS_NRF24L01_channel; </code><code class="comments">//Задаем канал</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>051</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.config(); </code><code class="comments">//Инициализируем модуль NRF24L01</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>052</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>053</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">set_sleep_mode(SLEEP_MODE_PWR_DOWN);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>054</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">sleep_enable();</code><code class="comments">//Переходим в спящий режим</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>055</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>056</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>057</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>058</code></td><td class="content"><code class="comments">//Вычисляет все данные и заполняет массив значений датчиков</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>059</code></td><td class="content"><code class="keyword">byte</code> <code class="plain">CalculateAllData()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>060</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>061</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//Serial.println("Calculate!");</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>062</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>063</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">float</code> <code class="plain">t, h, v;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>064</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>065</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">t = dht.readTemperature();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>066</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">h = dht.readHumidity();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>067</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">v = (</code><code class="keyword">float</code><code class="plain">)(analogRead(analogInPin)*5)/1023;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>068</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>069</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(isnan(t) || isnan(h)) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>070</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[0].Status = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>071</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[0].Value = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>072</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[1].Status = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>073</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[1].Value = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>074</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>075</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>076</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[0].Status = 1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>077</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[0].Value = t;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>078</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[1].Status = 1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>079</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MySensors[1].Value = h;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>080</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>081</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>082</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MySensors[2].Status = 1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>083</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MySensors[2].Value = v;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>084</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>085</code></td><td class="content"><code class="comments">//* </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>086</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"Data: "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>087</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="plain">Serial.print(t);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>088</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"*C "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>089</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="plain">Serial.print(h);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>090</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="plain">Serial.print(</code><code class="string">"% "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>091</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="plain">Serial.print(v);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>092</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="plain">Serial.println(</code><code class="string">"V"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>093</code></td><td class="content"><code class="comments">//*/</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>094</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>095</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>096</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>097</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>098</code></td><td class="content"><code class="plain">AS_Answer ExecuteCommand(AS_Command MyCommand){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>099</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>100</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer&nbsp; MyAnswer;&nbsp; </code><code class="comments">// Ответ</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>101</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>102</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyAnswer.Value&nbsp; = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>103</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//char P[]="Y";</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>104</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>105</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">switch</code> <code class="plain">(MyCommand.Command) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>106</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">0: </code><code class="comments">//Reset</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>107</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">"0."</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>108</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//resetFunc();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>109</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>110</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">1: </code><code class="comments">//Получиь количество датчиков</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>111</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">"1."</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>112</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = 1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>113</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Value&nbsp; = NumSensors;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>114</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">break</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>115</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">2: </code><code class="comments">//Рассчитать все значения датчиков</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>116</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">"2."</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>117</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = CalculateAllData();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>118</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">case</code> <code class="plain">4: </code><code class="comments">//Получиь значение датчика по номеру</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>119</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">"4."</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>120</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">((MyCommand.Parametr+1) &gt; NumSensors){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>121</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>122</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Value&nbsp; = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>123</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">memcpy(&amp;MyAnswer.Comment,&amp;</code><code class="string">"Too big num par."</code><code class="plain">, CommentLen);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>124</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>125</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>126</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = MySensors[MyCommand.Parametr].Status;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>127</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Value&nbsp; = MySensors[MyCommand.Parametr].Value;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>128</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">memcpy(&amp;MyAnswer.Comment,&amp;MySensors[MyCommand.Parametr].Comment, CommentLen);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>129</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//MyAnswer.Comment[0] = P[0];</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>130</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>131</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>132</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">MyAnswer;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>133</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>134</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>135</code></td><td class="content"><code class="keyword">void</code> <code class="plain">loop() {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>136</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>137</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Command MyCommand; </code><code class="comments">// Команда</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>138</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer&nbsp; MyAnswer;&nbsp; </code><code class="comments">// Ответ</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>139</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>140</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code><code class="plain">(!Mirf.isSending() &amp;&amp; Mirf.dataReady()){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>141</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Mirf.getData((</code><code class="keyword">byte</code> <code class="plain">*) &amp;MyCommand);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>142</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer = ExecuteCommand(MyCommand);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>143</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//delay(100); //это зачем?</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>144</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Mirf.send((</code><code class="keyword">byte</code> <code class="plain">*) &amp;MyAnswer);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>145</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">while</code><code class="plain">(Mirf.isSending()){}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>146</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Serial.println(</code><code class="string">"Send!"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>147</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>148</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>149</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">/* No data - night night. */</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>150</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">toSleep();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>151</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>152</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>

<p>Файл для "главного" блока (у меня OLED дисплей через i2c - поэтому чуток другой вывод, но суть не меняется, другие незначительные изменения):</p>
<div id="highlighter_999883" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_999883_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_999883" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>001</code></td><td class="content"><code class="preprocessor">#include &lt;SPI.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>002</code></td><td class="content"><code class="preprocessor">#include &lt;Mirf.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>003</code></td><td class="content"><code class="preprocessor">#include &lt;ASLibrary1.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>004</code></td><td class="content"><code class="preprocessor">#include &lt;MirfHardwareSpiDriver.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>005</code></td><td class="content"><code class="preprocessor">#include &lt;Wire.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>006</code></td><td class="content"><code class="preprocessor">#include &lt;SeeedOLED.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>007</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>008</code></td><td class="content"><code class="plain">boolean flag=0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>009</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>010</code></td><td class="content"><code class="plain">unsigned </code><code class="keyword">long</code> <code class="plain">cnt=0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>011</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>012</code></td><td class="content"><code class="keyword">char</code> <code class="plain">buf[9];</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>013</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>014</code></td><td class="content"><code class="keyword">void</code> <code class="plain">setup(){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>015</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Wire.begin();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>016</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">SeeedOled.init();&nbsp; </code><code class="comments">//initialze SEEED OLED display</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>017</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">DDRB |= 0x21;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">//digital pin 8, LED glow indicates Film properly Connected .</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>018</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">PORTB |= 0x21;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>019</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>020</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">SeeedOled.clearDisplay();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>021</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">SeeedOled.setNormalDisplay();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">//Set display to normal mode (i.e non-inverse mode)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>022</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">SeeedOled.setPageMode();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">//Set addressing mode to Page Mode</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>023</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>024</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.spi = &amp;MirfHardwareSpi;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>025</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>026</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.csnPin = 9;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>027</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.cePin = 8;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>028</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.init();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>029</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>030</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.setRADDR((</code><code class="keyword">byte</code> <code class="plain">*)</code><code class="string">"main"</code><code class="plain">);</code><code class="comments">// Устанавливаем адрес, под которым будем принимать данные</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>031</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>032</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.payload = AS_NRF24L01_payload;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>033</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.channel = AS_NRF24L01_channel; </code><code class="comments">//Задаем канал</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>034</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.config(); </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>035</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>036</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>037</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>038</code></td><td class="content"><code class="keyword">void</code> <code class="plain">loop(){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>039</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>040</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// внешний датчик, температура (DHT22), влажность (DHT22), температура (DS18B20), заряд батареи</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>041</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">char</code> <code class="plain">*addr = </code><code class="string">"WTHR"</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>042</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>043</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">GetMeasure(addr);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>044</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>045</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">SeeedOled.setTextXY(7,0);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>046</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">SeeedOled.putString(</code><code class="string">"cnt="</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>047</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">SeeedOled.putNumber(cnt);&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>048</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>049</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">cnt++;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>050</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>051</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">//delay(300000); // 5 минут </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>052</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">delay(1000); </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>053</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>054</code></td><td class="content"><code class="plain">} </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>055</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>056</code></td><td class="content"><code class="comments">//Посылает команду на устройство и вовращает ответ</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>057</code></td><td class="content"><code class="plain">AS_Answer GetAnswer(</code><code class="keyword">char</code> <code class="plain">*addr, </code><code class="keyword">byte</code> <code class="plain">Command, </code><code class="keyword">byte</code> <code class="plain">Parametr){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>058</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>059</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Command MyCommand; </code><code class="comments">// Команда</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>060</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer&nbsp; MyAnswer;&nbsp; </code><code class="comments">// Ответ</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>061</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">unsigned </code><code class="keyword">long</code> <code class="plain">time;&nbsp;&nbsp; </code><code class="comments">// Время для отслеживания таймаута при запросе данных</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>062</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>063</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.setTADDR((</code><code class="keyword">byte</code> <code class="plain">*)addr); </code><code class="comments">//Устанавливаем адрес, окуда считываем данные</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>064</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>065</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyCommand.Command = Command;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>066</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">MyCommand.Parametr = Parametr;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>067</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>068</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.send((</code><code class="keyword">byte</code> <code class="plain">*)&amp;MyCommand);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>069</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">while</code><code class="plain">(Mirf.isSending()){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>070</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>071</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>072</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">delay(1000);&nbsp; </code><code class="comments">// зачем?</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>073</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>074</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">time = millis();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>075</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">while</code><code class="plain">(!Mirf.dataReady()){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>076</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">( ( millis() - time ) &gt; 1000 ) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>077</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.clearDisplay();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>078</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.putString(</code><code class="string">"Timeout on "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>079</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.putString(addr);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>080</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer.Status = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>081</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">MyAnswer;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>082</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>083</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>084</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>085</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">Mirf.getData((</code><code class="keyword">byte</code> <code class="plain">*) &amp;MyAnswer);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>086</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>087</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">MyAnswer;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>088</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>089</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>090</code></td><td class="content"><code class="comments">//Рассчитывает все показания на устройстве с именем addr</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>091</code></td><td class="content"><code class="keyword">byte</code> <code class="plain">CalculateAllParametr(</code><code class="keyword">char</code> <code class="plain">*addr){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>092</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>093</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer MyAnswer = GetAnswer(addr, 2, 0);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>094</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>095</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(MyAnswer.Status == 0){</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>096</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.clearDisplay();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>097</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.putString(</code><code class="string">"Error calculate all values on&nbsp; "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>098</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.putString(addr);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>099</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>100</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>101</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">else</code><code class="plain">{&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>102</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Serial.print("Calculate all values OK on ");</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>103</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">//Serial.println(addr);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>104</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">1;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>105</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>106</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>107</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>108</code></td><td class="content"><code class="keyword">void</code> <code class="plain">GetMeasure(</code><code class="keyword">char</code> <code class="plain">*addr){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>109</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">byte</code> <code class="plain">Count;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>110</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">AS_Answer MyAnswer;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>111</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>112</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(CalculateAllParametr(addr) == 1) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>113</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">delay(10);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>114</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer = GetAnswer(addr, 1, 0); </code><code class="comments">//сколько датчиков?</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>115</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(MyAnswer.Status == 1) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>116</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">Count = MyAnswer.Value;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>117</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.setTextXY(0,0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">//Set the cursor to Xth Page, Yth Column&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>118</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.putString(addr);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>119</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.putString(</code><code class="string">" sensors: "</code><code class="plain">); </code><code class="comments">//Print the String</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>120</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.putNumber(Count);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>121</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>122</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">for</code><code class="plain">(</code><code class="keyword">byte</code> <code class="plain">i=0; i&lt;Count; i++){</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>123</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">delay(10);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>124</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">MyAnswer = GetAnswer(addr, 4, i);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>125</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.setTextXY(i+1,0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">//Set the cursor to Xth Page, Yth Column&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>126</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.putString((</code><code class="keyword">char</code> <code class="plain">*)MyAnswer.Comment);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>127</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">dtostrf(MyAnswer.Value,8,2,buf);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>128</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.putString(buf);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>129</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>130</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>131</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} </code><code class="keyword">else</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>132</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.clearDisplay();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>133</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">SeeedOled.putString(</code><code class="string">"Wrong!"</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>134</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>135</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>

<p>&nbsp;и вот в этом файле как раз "непонятка": в строке 126 должен печататься комментарий к датчику (Сергей, отличная мысль этот комментарий отдавать!)... но не печатается.. выдается какой-то мусор на дисплее :(</p>
<p>Подскажите, в чем проблема?... код "ведомого" и "главного" - максимально близок к Вашему (в части этого комментария), но не работает... а у Вас работает нормально?</p>
<p>Еще вопросы по задержкам (по коду) - как получили значения и догадались, что они там нужны? (кстати, от некоторых можно избавиться - те, что закоментированы у меня, а вот от секундной задержки в скетче для главного блока избавитья нельзя - сразу начинают идти недостоверные данные и т.п.).&nbsp;</p>
<p>&nbsp;</p>
<p>Кстати... я тут еще одни "грабли" нашел... Помните, я говорил, что начинаются ошибки (и вообще прекращается нормальная работа модулей), если "главный" один, а "ведомых" несколько?</p>
<p>Сегодня экспериментировал (типа, один блок центральный и два - "ведомых")... опрашивал модули последовательно друг за другом с таймаутом в 3-5 секунд.. "ведомые" блоки, конечно же, имеют разные адреса... работали все блоки на одном канале.</p>
<p>Так вот выяснилось, что&nbsp;несмотря на разные адреса (имена), "ведомые" блоки одновременно принимали команды и одновременно же кидались отвечать главному блоку (соответственно, мусор приходил конкретный). Выяснилось это когда добавил вывод отладочных сообщений о принятых командах всех "ведомых" блоков и мониторингом соответствующих ком-портов.</p>
<p>Есть мысль в качестве решения разделить модули по разным каналам, но надо тестировать.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9506"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Ср, 09/05/2012 - 11:20
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9506" class="active">#13</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        Serega7411      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 06.04.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>&nbsp;В 126 строке может по разному преобразуются типы переменных у разных классов. Можно попробовать явно указать ссылку SeeedOled.putString((char *)<strong>&amp;</strong>MyAnswer.Comment); у меня и с "&amp;" работает и без.</p>
<p>Задержки ставил везде, где посчитал что может повляють на работу, чтобы по любому заработало, потом при отладке будут удалены\уменьшены.</p>
<p>Про ответы не на свое имя ведомого блока: попрорбовал, все правильно работает откликается только на свое имя. Если запрашивать другое, то не откликается. У вас точно разные имена забиты в ведомых блоках?</p>
<p>Пример 100% рабочий, вот видео:<br>
&nbsp;</p>
<p><a href="http://youtu.be/9NKUc3GHAUM" rel="nofollow">youtu.be/9NKUc3GHAUM</a></p>

      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-9619"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пт, 11/05/2012 - 10:48
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-9619" class="active">#14</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>&nbsp;Моя ошибка с тем, что не передавался комментарий к датчику оказалась примитивнейшей.... я просто не заметил, что:</p>
<div id="highlighter_843433" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_843433_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_843433" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="preprocessor">#define AS_NRF24L01_payload 5</code></td></tr></tbody></table></div></div></div>

<p>Превратилось в&nbsp;</p>
<div id="highlighter_310149" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_310149_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_310149" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="preprocessor">#define AS_NRF24L01_payload 25</code></td></tr></tbody></table></div></div></div>

<p>После того, как нашел - передача комментариев заработала.</p>
<p>И разобрался с несколькими "датчиками" (сейчас у меня устойчиво работает один "центральный" и три "дочерних" модуля, уверен, что будут работать и все последующие).</p>
<p>Решение оказалось не очень сложным, но дойти до него было долго.&nbsp;</p>
<p>Если используется несколько блоков (со своими именами, конечно), то у каждого есть код типа:</p>
<div id="highlighter_964077" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_964077_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_964077" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">Mirf.setRADDR((</code><code class="keyword">byte</code> <code class="plain">*)</code><code class="string">"NAME"</code><code class="plain">); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">Mirf.setTADDR((</code><code class="keyword">byte</code> <code class="plain">*)</code><code class="string">"main"</code><code class="plain">);</code></td></tr></tbody></table></div></div></div>

<p>Где NAME имя соответствующего блока. Предполагалось, что main - имя главного блока и что этот код работает так: Имя, под которым принмаем - NAME, а имя блока, которому передаем - main.</p>
<p>Когда один главный и один ведомый - этот код работает. Как только ведомых становится больше - вот тут начинается чехарда. Данне идут как угодно, видна активность всех ведомых и т.п.</p>
<p>Зато, если исправить код ведомого вот так:</p>
<div id="highlighter_187213" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_187213_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_187213" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">Mirf.setRADDR((</code><code class="keyword">byte</code> <code class="plain">*)</code><code class="string">"NAME"</code><code class="plain">); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">Mirf.setTADDR((</code><code class="keyword">byte</code> <code class="plain">*)</code><code class="string">"NAME"</code><code class="plain">);</code></td></tr></tbody></table></div></div></div>

<p>Все сразу встает на свои места. Отзываются только те блоки, что нужно, работает стабильно.&nbsp;</p>
<p>Похоже, эти строчки реально работают так: Имя, под которым принимаем - NAME, имя под которым передаем - NAME.</p>
<p>Почему так - до конца не ясно. Смотрел даташит NRF24L01, так там вообще интересно. Для адресов используется несколько регистров. Один регистр - для "своего имени" и 6 - для модулей, с которыми осуществляется связь. На этих трансиверах можно много чего сделать.</p>
<p>&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-10213"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Чт, 24/05/2012 - 09:07
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-10213" class="active">#15</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>А вот и еще грабли...</p>
<p>Для проверки решил собрать еще один "ведомый" блок. При этом &nbsp;вконструкции уже "ничего лишнего" - на макетке установлена Атмега 168, резистор для подтягивания кнопки "сброс", кварцевый резонатор, два конденсатора к нему, один конденсатор по питанию.</p>
<p>Датчик использоую DHT11 (пока просто для теста, потом поменяю на DHT22), ему тоже 1 резистор потребовался.</p>
<p>Еще на макетке установил стабилизатор питания&nbsp;L78L33 (с соответствующими конденсаторами в цепи питания) - от него запитан модуль NRF2L01.</p>
<p>Вся эта конструкция запитана от 3 батареек ААА.</p>
<p>&nbsp;</p>
<p>Теперь о граблях:</p>
<p>1. Если Атмегу запитывать с выхода стабилизатора питания (3.3В) - не заводится почему-то (пришлось микроконтроллер запитать напрямую от блока батареек). Почему?</p>
<p>2. К сожалению, забыл замерить напряжение на батарейках при старте (но брал свежие из упаковки), после двух дней работы (опрос модуля один раз в 4 минуты) - напряжение на батарейном блоке всего 3.7В :( - похоже, блок не сможет работать достаточно продолжительное время :(</p>
<p>Из того, что пока придуалось и готовится к реализации:</p>
<p>1. Убрать внешний резонатор и пользоваться внутренним (минимизация количества элементов в устройстве и еще снижение питания при понижении тактовой частоты).</p>
<p>2. Убрать стабилизатор питания&nbsp;L78L33 и заменить его на делитель из двух резисторов.</p>
<p>&nbsp;</p>
<p>Может, у кого-то еще есть мысли, как "продлить жизнь"?</p>
<p>&nbsp;</p>
<p>P.S. Напомню, используется режим экономии энергии:&nbsp;set_sleep_mode(SLEEP_MODE_PWR_DOWN);</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-11019"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пнд, 11/06/2012 - 19:13
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-11019" class="active">#16</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        Elridge      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 11.06.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Всем привет.</p>
<p>Есть следующие идеи:</p>
<p>1. дополнительно к меге прикрутить блютуз (например HC-05) для управления с телефона или с планшета.</p>
<p>2. Прикрутить ethernet модуль. тут 2 варианта:</p>
<p>2.1 данные в инет выкладывать, sms-ки/e-mail-ы слать по определенным событиям</p>
<p>2.2 админить дистанционно.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22081"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Втр, 22/01/2013 - 16:20
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22081" class="active">#17</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Тема заглохла?...На какой стадии проект?...если не удалось решить проблему с энергосбережением - могу поделиться мыслями)</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22097"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Втр, 22/01/2013 - 20:45
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22097" class="active">#18</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Тема не заглохла, а перетекла чуток в <a href="http://arduino.ru/forum/programmirovanie/gsmsim900-sd#comment-20034" rel="nofollow">другое место</a>.</p>
<p>Про энергосбережение - очень интересно, делитесь, пожалуйста.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22853"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Сб, 02/02/2013 - 18:56
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22853" class="active">#19</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Идея была сделать беспроводной датчик температуры на базе NRF24...пока сделал для тестирования два таких датчика на DS18B20...оба работают автономно...Один на батарейкe Li CR2032 (ёмкость 220 &nbsp;mA &nbsp;3 V),&nbsp; другой на 2х типа AA (преположительно 2000 -3000 mA в сумме 3V) Мозг всего этого ATMega168PA-AU работающий на внутреннем резонаторе. Данные передаются каждые 8 сек, в промежутке мозг и NRF24 уходят в сон. Энергосбережение работает в полном объёме...проверял мультиметром. С каждого уходит инфа о номере датчика, вольтаж батарейки и соответственно температура. Тестировал в пределах квартиры, сигнал проходит через одну бетонную стенку без проблем и через две если немного подкорректировать положение NRF24 в пространстве. В зоне прямой видимости не тестировал, но читал про 100-120 метров (чуть позже проверим). Что сказать о степени разряда батареек...вначале тестирования CR2032 показала 3.1 Vв за первые 10 часов напряжение снизилось 2,9 V...затем стабилизаровалось и уже второй день держится 2,89 V ...судя по графикам разряда батареек найденных на просторах инета так и должно быть т.е в первый момент времени идёт интенсивное снижение напряжение, а затем более плавное и стабилизированное. Будем надеяться, что так и есть ) Две АА батарейки в начальный момент имели напругу 3.18 V, по прошествию 20 часов стабилизировалось на 3.11 V .</p>
<p>Осталось привести код в читаемый для всех вид ...постараюсь выложить сюда через пару тройку дней...</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22854"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Сб, 02/02/2013 - 19:21
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22854" class="active">#20</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Супер, делитесь :) очень интересно.</p>
<p>Я правильно понимаю, что питание напрямую (без стабилизаторов и преобразователей) подается как на мегу, так и на&nbsp;<span style="line-height:1.5em;">NRF24?</span></p>
<p>Какую библиотеку используете для работы&nbsp;<span style="line-height:1.5em;">NRF24 (Mirf или RF24)?</span></p>
<p>&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22856"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Сб, 02/02/2013 - 19:24
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22856" class="active">#21</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Да, питание напрямую и к меге и к NRF24....библиотека&nbsp;RF24</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22858"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Сб, 02/02/2013 - 20:04
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22858" class="active">#22</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>тогда сразу делитесь как кодом для "датчика", так и для "сервера" ;)</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22978"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пнд, 04/02/2013 - 22:15
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22978" class="active">#23</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Выкладываю немного приведя в порядок...может совместными усилиями окультурим потом. Код для передатчика...</p>
<div id="highlighter_663030" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_663030_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_663030" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>001</code></td><td class="content"><code class="preprocessor">#include &lt;SPI.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>002</code></td><td class="content"><code class="preprocessor">#include "nRF24L01.h"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>003</code></td><td class="content"><code class="preprocessor">#include "RF24.h"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>004</code></td><td class="content"><code class="preprocessor">#include &lt;avr/sleep.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>005</code></td><td class="content"><code class="preprocessor">#include &lt;avr/wdt.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>006</code></td><td class="content"><code class="preprocessor">#include &lt;Wire.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>007</code></td><td class="content"><code class="preprocessor">#include &lt;OneWire.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>008</code></td><td class="content"><code class="preprocessor">#include &lt;DallasTemperature.h&gt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>009</code></td><td class="content"><code class="preprocessor">#define ONE_WIRE_BUS 3</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>010</code></td><td class="content"><code class="plain">OneWire oneWire(ONE_WIRE_BUS);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>011</code></td><td class="content"><code class="plain">DallasTemperature sensors(&amp;oneWire);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>012</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>013</code></td><td class="content"><code class="comments">//int battVolts;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>014</code></td><td class="content"><code class="keyword">int</code> <code class="plain">count;&nbsp;&nbsp;&nbsp; </code><code class="comments">//переменная для счётчика циклов</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>015</code></td><td class="content"><code class="plain">volatile boolean wdt_tripped=1;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>016</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>017</code></td><td class="content"><code class="plain">RF24 radio(8,7); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>018</code></td><td class="content"><code class="keyword">const</code> <code class="plain">uint64_t pipes[2] = { 0xF0F0F0F0E1LL, 0xF0F0F0F0D2LL };</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>019</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>020</code></td><td class="content"><code class="comments">//создаём структуру для передачи 4х значений</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>021</code></td><td class="content"><code class="plain">typedef </code><code class="keyword">struct</code><code class="plain">{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>022</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">int</code> <code class="plain">W;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>023</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">int</code> <code class="plain">X;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>024</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">float</code> <code class="plain">Y;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>025</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">float</code> <code class="plain">Z;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>026</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>027</code></td><td class="content"><code class="plain">B_t;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>028</code></td><td class="content"><code class="plain">B_t duino2; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>029</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>030</code></td><td class="content"><code class="comments">//режим сна для МК</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>031</code></td><td class="content"><code class="keyword">void</code> <code class="plain">system_sleep() {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>032</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">delay(2);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">// Wait for serial traffic</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>033</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">_SFR_BYTE(ADCSRA) &amp;= ~_BV(ADEN);&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">// Switch ADC off</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>034</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">set_sleep_mode(SLEEP_MODE_PWR_DOWN);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>035</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">sleep_enable();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>036</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">sleep_mode();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">// System sleeps here</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>037</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">sleep_disable();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>038</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">_SFR_BYTE(ADCSRA) |= _BV(ADEN);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="comments">// Switch ADC on</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>039</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>040</code></td><td class="content"><code class="keyword">void</code> <code class="plain">wdt_interrupt_mode() {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>041</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">wdt_reset();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>042</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">WDTCSR |= _BV(WDIE); </code><code class="comments">// Restore WDT interrupt mode</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>043</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>044</code></td><td class="content"><code class="plain">ISR(WDT_vect) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>045</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">wdt_tripped=1;&nbsp; </code><code class="comments">// set global volatile variable</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>046</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>047</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>048</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>049</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>050</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>051</code></td><td class="content"><code class="keyword">void</code> <code class="keyword">setup</code><code class="plain">()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>052</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>053</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">wdt_disable();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>054</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">wdt_reset();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>055</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">wdt_enable(WDTO_8S);&nbsp;&nbsp; </code><code class="comments">//пробуждение каждые 8 сек</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>056</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">count = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>057</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>058</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>059</code></td><td class="content"><code class="plain">sensors.begin();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>060</code></td><td class="content"><code class="plain">radio.begin();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>061</code></td><td class="content"><code class="plain">radio.openWritingPipe(pipes[0]);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>062</code></td><td class="content"><code class="plain">radio.openReadingPipe(1,pipes[1]);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>063</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>064</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>065</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>066</code></td><td class="content"><code class="keyword">void</code> <code class="keyword">loop</code><code class="plain">(</code><code class="keyword">void</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>067</code></td><td class="content"><code class="plain">{ </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>068</code></td><td class="content"><code class="plain">radio.powerUp();&nbsp; </code><code class="comments">//подаём питание на NRF24</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>069</code></td><td class="content"><code class="plain">radio.stopListening(); </code><code class="comments">// отключаем режим приёма</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>070</code></td><td class="content"><code class="plain">sensors.requestTemperatures();&nbsp; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>071</code></td><td class="content"><code class="keyword">float</code> <code class="plain">t = sensors.getTempCByIndex(0);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>072</code></td><td class="content"><code class="plain">delay(20);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>073</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>074</code></td><td class="content"><code class="keyword">int</code> <code class="plain">vb = getBandgap (); </code><code class="comments">// записываем в переменную vb значение замеренного напряжения с батарии</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>075</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>076</code></td><td class="content"><code class="comments">//записываем в структуру данные для передачи</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>077</code></td><td class="content"><code class="plain">duino2.W = 11;&nbsp; </code><code class="comments">// этот номер передатчика для идентификации в принятом пакете данных</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>078</code></td><td class="content"><code class="plain">duino2.X = vb;&nbsp; </code><code class="comments">// передаём напряжение батареи</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>079</code></td><td class="content"><code class="plain">duino2.Y =t;&nbsp;&nbsp;&nbsp; </code><code class="comments">// передаём температуру</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>080</code></td><td class="content"><code class="plain">duino2.Z = t;&nbsp;&nbsp; </code><code class="comments">// продублирована (можно менять на любую переменную)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>081</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>082</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>083</code></td><td class="content"><code class="comments">//тут можно увеличить интервал времени между отправками данных по RF24 за счёт счётчика циклов</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>084</code></td><td class="content"><code class="plain">wdt_interrupt_mode();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>085</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(wdt_tripped) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>086</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">count++;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>087</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">wdt_tripped = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>088</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>089</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(count == 9) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>090</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">delay(20);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>091</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">count = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>092</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>093</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>094</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>095</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>096</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>097</code></td><td class="content"><code class="keyword">bool</code> <code class="plain">ok = radio.write( &amp;duino2, </code><code class="keyword">sizeof</code><code class="plain">(duino2) ); </code><code class="comments">//отправляем данные по RF24</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>098</code></td><td class="content"><code class="plain">delay (20); </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>099</code></td><td class="content"><code class="plain">radio.powerDown(); </code><code class="comments">// отключаем питание RF24</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>100</code></td><td class="content"><code class="plain">system_sleep();&nbsp;&nbsp; </code><code class="comments">//МК засыпает</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>101</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>102</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>103</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>104</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>105</code></td><td class="content"><code class="comments">//внутренний контроль напряжения на батареи </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>106</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>107</code></td><td class="content"><code class="keyword">const</code> <code class="keyword">long</code> <code class="plain">InternalReferenceVoltage = 1062; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>108</code></td><td class="content"><code class="keyword">int</code> <code class="plain">getBandgap () </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>109</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>110</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// REFS0 : Selects AVcc external reference</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>111</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="comments">// MUX3 MUX2 MUX1 : Selects 1.1V (VBG)&nbsp; </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>112</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><code class="plain">ADMUX = _BV (REFS0) | _BV (MUX3) | _BV (MUX2) | _BV (MUX1);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>113</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><code class="plain">ADCSRA |= _BV( ADSC );&nbsp; </code><code class="comments">// start conversion</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>114</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><code class="keyword">while</code> <code class="plain">(ADCSRA &amp; _BV (ADSC))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>115</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">{ }&nbsp; </code><code class="comments">// wait for conversion to complete</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>116</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><code class="keyword">int</code> <code class="plain">results = (((InternalReferenceVoltage * 1024) / ADC) + 5) / 10; </code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>117</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;</code><code class="keyword">return</code> <code class="plain">results;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>118</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">} </code><code class="comments">// end of getBandgap</code></td></tr></tbody></table></div></div></div>

<p>&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22979"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пнд, 04/02/2013 - 22:19
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22979" class="active">#24</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Код приёмника...</p>
<div id="highlighter_390490" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_390490_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_390490" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="preprocessor">#include &lt;SPI.h&gt;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="preprocessor">#include "nRF24L01.h"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="preprocessor">#include "RF24.h"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="plain">typedef </code><code class="keyword">struct</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">int</code> <code class="plain">W;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">int</code> <code class="plain">X;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">float</code> <code class="plain">Y;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">float</code> <code class="plain">Z;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="plain">B_t;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="plain">B_t duino2;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="plain">RF24 radio(8,7);&nbsp;&nbsp; </code><code class="comments">// make sure this corresponds to the pins you are using</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="keyword">const</code> <code class="plain">uint64_t pipes[2] = { 0xF0F0F0F0E1LL, 0xF0F0F0F0D2LL };</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="keyword">void</code> <code class="keyword">setup</code><code class="plain">()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">Serial</code><code class="plain">.begin(9600);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">radio.begin();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">radio.openWritingPipe(pipes[1]);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">radio.openReadingPipe(1,pipes[0]);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">radio.startListening();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>25</code></td><td class="content"><code class="spaces">&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>26</code></td><td class="content"><code class="keyword">void</code> <code class="keyword">loop</code><code class="plain">(</code><code class="keyword">void</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>27</code></td><td class="content"><code class="plain">{ </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>28</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>29</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">( radio.available() )</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>30</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>31</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">bool</code> <code class="plain">done = </code><code class="keyword">false</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>32</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">while</code> <code class="plain">(!done)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>33</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>34</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">done = radio.read( &amp;duino2, </code><code class="keyword">sizeof</code><code class="plain">(duino2) );</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>35</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>36</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">Serial</code><code class="plain">.print(</code><code class="string">"duino2.W = "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>37</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">Serial</code><code class="plain">.println(duino2.W);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>38</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">Serial</code><code class="plain">.print(</code><code class="string">"duino2.X = "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>39</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">Serial</code><code class="plain">.println(duino2.X);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>40</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">Serial</code><code class="plain">.print(</code><code class="string">"duino2.Y = "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>41</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">Serial</code><code class="plain">.println(duino2.Y);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>42</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">Serial</code><code class="plain">.print(</code><code class="string">"duino2.Z = "</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>43</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">Serial</code><code class="plain">.println(duino2.Z); </code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>44</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>45</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>46</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>47</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>

<p>&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22980"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пнд, 04/02/2013 - 22:40
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22980" class="active">#25</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>&nbsp;Теперь о проблемах, которые нарисовываются (...</p>
<p>Напряжение на CR2032 упало до 2.74 V, замер внутри&nbsp; МК немного меньше (был введён поправочный коэф. = 1.05) Поэтому с предыдущей прошивкой фьюзов МК отключался. Прочитал, что народ писал на буржуйских сайтах, мол можно поставить значение отключения МК меньше...выставил новые фьюзы...теперь должен отключаться при 1.8 V, возможно раньше начнутся глюки...посмотрим, пока работает.&nbsp; Но дело не в этом...неужели даже при таком энергосбережении, а оно есть, проверено мультиметром реально, всё равно получим значительный разряд батареии...тогда запаримся менять бытрейки, а это очень грустно. Есть выход ввести счётчик циклов и подавать питание на NRF24 не раз в 8 сек, а допустим 1 раз в минуту. Насколько это даст прирост? в 8 раз?...допустим, когда закончится мой тест батарея проживёт неделю, тогда примерно&nbsp; 2 месяца будет в запасе....уже неплохо, но мало...с другой стороны это на CR2032 &nbsp;емкостью 220 мА...если посмотреть в сторону 2х АА батареек, то там около 2000 мА...увеличим ещё примерно в 9 раз...Второй датчик тестируется на 2х АА...сейчас на этих батареях показывает 3.01 V... разряд идёт немного плавнее чем на CR2032...В общем планирую довести до конца тест на этих элементах и получить реальный срок их работы в таком режиме....дальше нужно будет манипулировать и как-то увеличивать энергосбережение...</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22981"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пнд, 04/02/2013 - 22:49
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22981" class="active">#26</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Теперь немного ссылок откуда черпалось вдохновение.</p>
<p><a href="http://maniacbug.wordpress.com/2011/10/19/sensor-node/" title="http://maniacbug.wordpress.com/2011/10/19/sensor-node/" rel="nofollow">http://maniacbug.wordpress.com/2011/10/19/sensor-node/</a></p>
<p><a href="http://www.bajdi.com/sending-structs-with-nrf24l01-modules-and-the-rf24-library/" title="http://www.bajdi.com/sending-structs-with-nrf24l01-modules-and-the-rf24-library/" rel="nofollow">http://www.bajdi.com/sending-structs-with-nrf24l01-modules-and-the-rf24-...</a></p>
<p><a href="https://arduino-info.wikispaces.com/Nrf24L01-2.4GHz-HowTo" title="https://arduino-info.wikispaces.com/Nrf24L01-2.4GHz-HowTo" rel="nofollow">https://arduino-info.wikispaces.com/Nrf24L01-2.4GHz-HowTo</a></p>
<p><a href="https://github.com/maniacbug" title="https://github.com/maniacbug" rel="nofollow">https://github.com/maniacbug</a></p>
<p><a href="http://arduino.cc/forum/index.php?PHPSESSID=ee799e863c7f3fa94827ac45459ce28f&topic=141837.0" title="http://arduino.cc/forum/index.php?PHPSESSID=ee799e863c7f3fa94827ac45459ce28f&amp;topic=141837.0" rel="nofollow">http://arduino.cc/forum/index.php?PHPSESSID=ee799e863c7f3fa94827ac45459c...</a></p>
<p>&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22982"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пнд, 04/02/2013 - 22:50
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22982" class="active">#27</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>spa-sam, спасибо - обязательно попробую (как только немного времени свободного появится).</p>
<p>Мне кажется, что коду нехватает немного гибкости - сейчас количество передаваемых данных строго ограничено, а как быть, если у "датчика" больше данных? Можно, конечно, создать длинную структуру и грузить туда все, но это как-то не очень.</p>
<p>Может, взять идею из скетчей в начале ветки?</p>
<p>Поясню, что там:</p>
<p>1. Двусторонний обмен ("база" спрашивает "датчик", а "датчик" потом отвечает).</p>
<p>2. Одна команда позволяет "спросить", сколько датчиков.</p>
<p>3. Дальше можно уже давать "адресный" запрос (т.е. "датчик, какое значение параметра номер ххх")</p>
<p>P.S. в скетчах выше есть еще доп.команда - "сделать измерение", а потом уже "пришли данные", тут уже избыточность.. имхо, "датчик" уже должен иметь значение "наготове".</p>
<p>И еще... датчик, думаю, лучше "будить" для измерения через регулярные промежутки времени (для температуры, например, раз в 10 минут, имхо, будет достаточно)... но только "будить", чтобы измерить и запомнить текущие значения и сразу "спать"... а "отдавать" данные уже тогда, когда база их запросила (nrf24 можно завести на прерывание и по нему уже "будить" МК).</p>
<p>Что скажете?&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22985"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пнд, 04/02/2013 - 23:15
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22985" class="active">#28</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Не совсем понятно как получить данные с МК по запросу (прерыванию), который в данный момент спит, а просыпается максимум на секунду с учётом считывания данных с датчиков? Если завести NRF на прерывание, то я так понимаю сам NRF в сон уже не погрузить - он должен постоянно слушать эфир, а это плохо...всё энергосбережение коню под хвост т.к. NRF24 в активном режиме потребляет поряд 14мА...</p>
<p>К тому же давайте подумаем насколько много данных нужно передавать ?&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22986"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пнд, 04/02/2013 - 23:36
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22986" class="active">#29</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>и ещё совсем забыл про 10 минут...думаю это довольно много....нет...если бы допустим каждые 10 минут данные точно приходили, то нормально, а так бывает, что 2...3 пакета теряются и поэтому время получения данных может значительно увеличится&nbsp;</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-22999"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Втр, 05/02/2013 - 09:17
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-22999" class="active">#30</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        step962      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 23.05.2011        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Передайте свой пакет данных с контрольной суммой, затем - в зависимости от ответа с головного устройства (ACK/NAK) - либо (ACK) засыпайте на очередные 10 минут , либо (NAK) повторяйте передачу до победного конца.</p>
<p>&nbsp;</p>
<p><em>"Протокол ACK/NAK получил свое название по названию управляющих символов стандарта ASCII — AC Knowledge (уведомление об успешном приеме данных) и Not ACKnowledge (отсутствие уведомления об успешном приеме данных). Эти символы используются в качестве средства исправления ошибок переданных данных. В основном, протокол ACK/NAK предполагает, что блоку данных предшествует символ Start-Of-Text (начало текста, STX), а за блоком следуют символ End-Of-Text (конец текста, ЕТХ) и код проверки наличия ошибок. На приемном конце выполняется контроль символа проверки блока (Block Check Character, ВСС) на предмет ошибок. В зависимости от результата проверки возвращается либо сигнал АСК, свидетельствующий об успешности передачи, либо сигнал NAK, свидетельствующий о возникновении ошибки. В случае возврата сигнала NAK передающее устройство отвечает повтором передачи всего блока.<span style="line-height:1.5em;">"</span></em></p>
<p>Если ACK/NAK для вас представляется слишком сложным, попробуйте реализовать протокол ETX/ACK - там никаких контрольных сумм нет. Но, соответственно, и никакого контроля ошибок передачи, кроме проверки факта приема на том конце хоть чего-то похожего на правильный пакет данных.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-23005"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Втр, 05/02/2013 - 12:53
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-23005" class="active">#31</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p></p><div class="quote-msg"><div class="quote-author"><em>spa-sam</em> пишет:</div><p></p>
<p>Не совсем понятно как получить данные с МК по запросу (прерыванию), который в данный момент спит, а просыпается максимум на секунду с учётом считывания данных с датчиков? Если завести NRF на прерывание, то я так понимаю сам NRF в сон уже не погрузить - он должен постоянно слушать эфир, а это плохо...всё энергосбережение коню под хвост т.к. NRF24 в активном режиме потребляет поряд 14мА...</p>
<p></p></div><p></p>
<p>Когда читал документацию на&nbsp;<span style="line-height:1.5em;">NRF24 - у него тоже есть режимы энергосбережения собственные - надо почитать повнимательнее.&nbsp;</span></p>
<p><span style="line-height:1.5em;"></span></p><div class="quote-msg"><div class="quote-author"><em>spa-sam</em> пишет:</div><p></p>
<p>К тому же давайте подумаем насколько много данных нужно передавать ?&nbsp;</p>
<p></p></div><p></p>
<p>В каждом конкретном случае это количество может быть разным.&nbsp;</p>
<p>К примеру:</p>
<p>1. датчик температуры - 1 параметр</p>
<p>2. "погодный" датчик - 3-4 параметра (температура, влажность, давление, освещенность)</p>
<p>и т.п. у меня сейчас есть "датчик", который передает 7 параметров&nbsp;</p>
<p>При этом еще один параметр надо добавлять для датчиков, которые работают автономно на батарейке - об уровне заряда элемента питания.</p>
<p>Потом, не все "дочерние" элементы могут быть просто "датчиками" (и по большому счету толкьо отдавать свои данные), но и могут быть "исполнителями" (получили команду и что-то там сделали) - эти вообще если и должны спать, то крайне чутко, чтобы не проспать команду.</p>
<p>&nbsp;</p>
<p>Про подтверждение получения - тоже что-то встречалось в документации на&nbsp;<span style="line-height:1.5em;">NRF24 - надо разбираться.</span></p>
<p><span style="line-height:1.5em;">Правда, если все это разобрать и реализовать, то, пожалуй, уже можно будет выходить и на коммерческий уровень.</span></p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-23015"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Втр, 05/02/2013 - 13:49
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-23015" class="active">#32</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>В коде передатчика есть строка &nbsp;radio.powerDown();&nbsp;</p>
<p>так вот именно эта команда и переводит NRF24 в спящий режим, а выводит из него radio.powerUp();</p>
<p>Все манипуляции с обратной связью будут в ущерб энергосбережению, тут тогда нужно выбирать, что важнее).&nbsp;</p>
<p>По этой ссылке можно посмотреть пример с обратной связью&nbsp;<a href="http://www.bajdi.com/sending-structs-with-nrf24l01-modules-and-the-rf24-library/" rel="nofollow">http://www.bajdi.com/sending-structs-with-nrf24l01-modules-and-the-rf24-library/</a></p>
<p>Можно конечно попробовать слать команду до посинения, пока датчик не проснётся и поймает пакет, но опять же нужно найти тот баланс...т.е. период просыпаний, чтобы энергосбережение было сохранено на приемлемом уровне.</p>
<p>По поводу количества датчиков...не вижу проблем расширить структуру...в чём может быть негатив?</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-23688"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Сб, 16/02/2013 - 01:37
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-23688" class="active">#33</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Итак, батарейка CR2032 продержалась 2 недели, вольтаж показывает 2.37...появилась нестабильная работа МК... 2 недели для CR2032&nbsp;(ёмкость 220 mA 3 V) при 8 сек частоте передачи данных думаю неплохо...увеличил это дело в 9 раз...теперь частота получится 72 сек...проверил....работает отлично, даже на той же батарейке МК ещё что-то стал передавать...Т.е. получается, что на&nbsp;CR2032 при частоте пердачи данных 72 сек мы можем увеличить жизнь её примерно на 4 месяца... Эксперемент продолжаем...меняем батарейку и проверяем дальше ))</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-23690"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Сб, 16/02/2013 - 06:44
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-23690" class="active">#34</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        9ser      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 18.11.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>&nbsp;А с ведомого устройства можно получить состояние пинов "1" или "0", и так же поменять состояние пинов "1" или "0".</p>
<p>Допустим управление светом в комнате где стоит ведомый модуль и получение состояния???</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-24166"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Вс, 24/02/2013 - 10:29
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-24166" class="active">#35</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Вчера взял за основу код spa-sam (спасибо за "пинок";)) и чуток поколдовал.&nbsp;</p>
<p>Получилось (тестировал в конфигурации 1 "master" и 2 "slave"):</p>
<p>1. Односторонний режим ("slave" периодически отправляет свои данные, "мастер" их принимает)</p>
<p>2. Двустронний режим ("мастер" отправляет конерктному "слейву" команду, "слейв" реагирует)</p>
<p>&nbsp;- режимы работы задаются непосредственно в слейвах (мастер одновременно может работать как с теми, так и с другими).</p>
<p>&nbsp;- команды: получить значение параметра номер ...., установить значение параметра номер....</p>
<p>&nbsp;- команды адресные (указывается от кого и кому команда)</p>
<p>&nbsp;- пакет передаваемых данных модифицировал так, чтобы структура была всегда одинаковая, но количество параметров у каждого девайса - свое и произвольного количества.</p>
<p>&nbsp;</p>
<p>В процессе экспериментов получал значение с одного датчика (реально датчик было лень подключать, "слейв" просто счетчик накручивал и его значения периодически отправлял). Второму "слейву" отправлялась команда, которая по установке значения отрабатывала "дрыгание пином" (для наглядности светодиод на него повесил).</p>
<p>Структуру передаваемого пакета пока не выкладываю - обнаружилось, что одну вещь еще не предусмотрел (как поправлю и потестирую - выложу).</p>
<p>&nbsp;</p>
<p>P.S. до этого использовал библиотеку Mirf и все мои домашние девайсы с ее помощью реализованы... похоже, придется все переделывать на RF24 (заодно еще ждущие своего времени <a href="http://devicter.ru/goods/Iteaduino-Iboard" rel="nofollow">iBoard</a> и <a href="http://devicter.ru/goods/Iteaduino-Iboard-pro" rel="nofollow">iBoard Pro</a>, похоже, дождались (на них Mirf из-за "неправильного" подключения nrf24 не удавалось завести)).</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-24196"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Вс, 24/02/2013 - 19:33
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-24196" class="active">#36</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ustas      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 12.03.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>spa-sam, поясните пожалуйста, что делает вот этот кусок кода:&nbsp;</p>
<div id="highlighter_675119" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_675119_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_675119" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="plain">wdt_interrupt_mode();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="keyword">if</code> <code class="plain">(wdt_tripped) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">count++;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">wdt_tripped = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(count == 9) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">delay(20);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">count = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>

<p>и вот это:</p>
<p></p><div class="quote-msg"><div class="quote-author"><em>spa-sam</em> пишет:</div><p></p>
<p>Итак, батарейка CR2032 продержалась 2 недели, вольтаж показывает 2.37...появилась нестабильная работа МК... 2 недели для CR2032&nbsp;(ёмкость 220 mA 3 V) при 8 сек частоте передачи данных думаю неплохо...увеличил это дело в 9 раз...теперь частота получится 72 сек...проверил....работает отлично, даже на той же батарейке МК ещё что-то стал передавать...Т.е. получается, что на&nbsp;CR2032 при частоте пердачи данных 72 сек мы можем увеличить жизнь её примерно на 4 месяца... Эксперемент продолжаем...меняем батарейку и проверяем дальше ))</p>
<p></p></div><p></p>
<p>Тоже хочу время между отправками увеличить (правда, раза в 4, думаю, будет достаточно). Как сделать?</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-24220"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пнд, 25/02/2013 - 17:43
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-24220" class="active">#37</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>этот кусок кода как раз и увеличивает время между просыпаниями...точне тут идёт счёт пробуждений МК ...я сделал так:</p>
<div id="highlighter_338271" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#viewSource" title="код" class="item viewSource" style="width: 16px; height: 16px;">код</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_338271_clipboard" type="application/x-shockwave-flash" title="скопировать" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_338271" menu="false" src="/sites/all/libraries/syntaxhighlighter/scripts/clipboard.swf"></div><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#printSource" title="расечатать" class="item printSource" style="width: 16px; height: 16px;">расечатать</a><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="plain">wdt_interrupt_mode();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(wdt_tripped) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">count++;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">wdt_tripped = 0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">if</code> <code class="plain">(count == 9) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">radio.powerUp();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword">bool</code> <code class="plain">ok = radio.write( &amp;duino2, </code><code class="keyword">sizeof</code><code class="plain">(duino2) ); </code><code class="comments">//отправляем данные по RF24</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">delay(20);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">count = 0;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">radio.powerDown();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">}</code></td></tr></tbody></table></div></div></div>

<p>т.е. как только счёт равен 9 обнуляем счётчик, подаём питалово на RF24, отправляем данные и снова усыпляем RF24 до того момента пока счёт не станет 9</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-24247"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Пнд, 25/02/2013 - 23:44
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-24247" class="active">#38</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ales2k      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 25.02.2013        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Hi многоуважаемый All&nbsp;</p>
<p>Занимаюсь примерно темже, только приемником для датчиков будет экран-часы на светодиодных панелях.&nbsp;<span style="line-height:1.5em;">Код очень сходный, для увеличения срока жизни автономного датчика добавил Li-Ion CR123A с зарядно-разрядным модулем и солнечную батарейку 5.5v 70ма(при 100 Ватт света на 1 м кв.) размером 4см на 7 см. Хотелось компактнее, но что было под рукой. Для повышения дальности вроде можно поиграть со скоростью передачи RF24, но пока руки не дошли, жду панели из китая.</span></p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-24252"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Втр, 26/02/2013 - 07:40
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-24252" class="active">#39</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        mr.il      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 05.01.2013        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Всем привет!</p>
<p></p><div class="quote-msg"><div class="quote-author"><em>spa-sam</em> пишет:</div><p></p>
<p>Не совсем понятно как получить данные с МК по запросу (прерыванию), который в данный момент спит, а просыпается максимум на секунду с учётом считывания данных с датчиков? Если завести NRF на прерывание, то я так понимаю сам NRF в сон уже не погрузить - он должен постоянно слушать эфир, а это плохо...всё энергосбережение коню под хвост т.к. NRF24 в активном режиме потребляет поряд 14мА...</p>
<p>К тому же давайте подумаем насколько много данных нужно передавать ?&nbsp;</p>
<p></p></div><p></p>
<p>На сервере можно сделать "стек" команд, типа:</p>
<p>"Клиент1, дай все данные"</p>
<p>Когда клиент просыпается, он шлет на сервер сообщение, что он проснулся. Сервер отвечает что он слышит клиента, (если в течение&nbsp; какого то времени сервер не присылает ответ, клиент засыпает вновь, но на меньший срок). Сервер смотрит в свой стек и шлет клиенту команды, клиент отвечает. По исчерпанию в "стеке" команд для данного клиента, сервер шлет клиенту команду - "отбой" и клиент засыпает.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-24258"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Втр, 26/02/2013 - 08:44
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-24258" class="active">#40</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        spa-sam      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 14.12.2012        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p></p><div class="quote-msg"><div class="quote-author"><em>mr.il</em> пишет:</div><p></p>
<p>&nbsp;</p>
<p>На сервере можно сделать "стек" команд, типа:</p>
<p>"Клиент1, дай все данные"</p>
<p>Когда клиент просыпается, он шлет на сервер сообщение, что он проснулся. Сервер отвечает что он слышит клиента, (если в течение&nbsp; какого то времени сервер не присылает ответ, клиент засыпает вновь, но на меньший срок). Сервер смотрит в свой стек и шлет клиенту команды, клиент отвечает. По исчерпанию в "стеке" команд для данного клиента, сервер шлет клиенту команду - "отбой" и клиент засыпает.</p>
<p></p></div><p></p>
<p>я думал уже о таком способе, но пока просто нет надобности в обратной связи</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-24260"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Втр, 26/02/2013 - 09:02
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-24260" class="active">#41</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        mr.il      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 05.01.2013        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>За то контроллеру датчика не надо будет задумываться услышали его или нет, т.е. будет гарантированная доставка данных.</p>
<p>А ещё, я бы сделал отдельный контроллер отвечающий за коммуникации с клиентами. А основной контроллер уже с него брал бы данные.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-24279"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Втр, 26/02/2013 - 15:58
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-24279" class="active">#42</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ales2k      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 25.02.2013        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Контролировать прохождение данных в общем не задача датчика, а вот контроллер должен чтото сделать если данные не получил - например позвать пользователя и нажаловаться :)</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-24294"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Втр, 26/02/2013 - 18:08
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-24294" class="active">#43</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        mr.il      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 05.01.2013        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p></p><div class="quote-msg"><div class="quote-author"><em>ales2k</em> пишет:</div><p></p>
<p>Контролировать прохождение данных в общем не задача датчика, а вот контроллер должен чтото сделать если данные не получил - например позвать пользователя и нажаловаться :)</p>
<p></p></div><p></p>
<p>вопрос был таким:</p>
<div class="quote-author">
	<div class="quote-msg"><div class="quote-author"><em>&lt;em&gt;spa-sam&lt;/em&gt;</em> пишет:</div></div>
<p>Не совсем понятно как получить данные с МК по запросу (прерыванию), который в данный момент спит, а просыпается максимум на секунду с учётом считывания данных с датчиков? Если завести NRF на прерывание, то я так понимаю сам NRF в сон уже не погрузить - он должен постоянно слушать эфир, а это плохо...всё энергосбережение коню под хвост т.к. NRF24 в активном режиме потребляет поряд 14мА...</p>
<p>К тому же давайте подумаем насколько много данных нужно передавать ?</p>
<p></p></div><p></p>
<p>Я ответил, как я вижу решение этой проблемы. Конечно же вопрос доставки не задача датчика, по этому и говрю что на задачу соединений с датчиками повесил бы на отдельный контроллер.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-24297"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Втр, 26/02/2013 - 18:46
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-24297" class="active">#44</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        ales2k      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 25.02.2013        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Предлагаю простой способ - предусмотреть у датчика 2 режима работы: только передача и передача с контролем первый режим использовать постоянно а второй допустим раз в пару часов. И электричество экономится и контроль есть. Сам всегда передаю данные 2 раза подряд, если не совпадают - соответственно передача не прошла...</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-27042"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Чт, 28/03/2013 - 12:56
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-27042" class="active">#45</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        triada13      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 04.01.2013        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Доброе время суток. Плиз поделитесь рабочими библиотеками на NRF24L01+, а то что то не могу заставить работать скачанное постоянно возникают ошибки компиляции, а знаний пока мягко говоря недостаточно чтоб поправить код библиотек.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-27051"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Чт, 28/03/2013 - 14:22
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-27051" class="active">#46</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        toc      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 09.02.2013        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>rf24 &nbsp;от &nbsp;maniacbug хорошая.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-27055"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Чт, 28/03/2013 - 14:50
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-27055" class="active">#47</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        triada13      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 04.01.2013        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p></p><div class="quote-msg"><div class="quote-author"><em>toc</em> пишет:</div><p></p>
<p>rf24 &nbsp;от &nbsp;maniacbug хорошая.</p>
<p></p></div><p></p>
<p>Так а где ее качнуть можно? кинь ссылку плиз.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-27057"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Чт, 28/03/2013 - 15:12
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-27057" class="active">#48</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        toc      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 09.02.2013        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p><a href="http://bit.ly/14xRzjG%C2%A0" title="http://bit.ly/14xRzjG " rel="nofollow">http://bit.ly/14xRzjG&nbsp;</a></p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-27062"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Чт, 28/03/2013 - 17:01
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-27062" class="active">#49</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        triada13      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 04.01.2013        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p>Большое спасибо, буду разбираться, если смогу.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><a id="comment-32820"></a>

    <div class="forum-post  clear-block">

  <div class="post-info clear-block">
    <div class="posted-on">
      Чт, 13/06/2013 - 23:05
          </div>

          <span class="post-num"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#comment-32820" class="active">#50</a> </span>
      </div>

  <div class="forum-post-wrapper">

    <div class="forum-post-panel-sub">
      

<div class="author-pane">
 <div class="author-pane-inner">
        <div class="author-pane-section author-pane-general">
            <div class="author-pane-line author-name">
        dbg      </div>

                    
      
                    <div class="author-pane-line author-offline">
           Offline        </div>
      
            
            
            
                    <div class="author-pane-line author-joined">
          <span class="author-pane-label">Зарегистрирован:</span> 30.01.2013        </div>
      
            
                </div>

        <div class="author-pane-section author-pane-contact">
            
            
            
                </div>

        <div class="author-pane-section author-pane-admin">
            
          
               </div>
  </div>
</div>
    </div>

    <div class="forum-post-panel-main clear-block">
      
      <div class="content">
        <p></p><div class="quote-msg"><div class="quote-author"><em>ales2k</em> пишет:</div><p></p>
<p><span style="line-height:1.5em;">для увеличения срока жизни автономного датчика добавил Li-Ion CR123A с зарядно-разрядным модулем и солнечную батарейку 5.5v 70ма(при 100 Ватт света на 1 м кв.) размером 4см на 7 см. </span></p>
<p></p></div><p></p>
<p>Поделитесь, пожалуйста, ссылками.</p>
      </div>

          </div>
  </div>

  <div class="forum-post-footer clear-block">
    <div class="forum-jump-links">
      <a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#top" title="Jump to top of page">Верх</a>
    </div>

          <div class="forum-post-links">
        <ul class="links forum-links"><li class="comment_forbidden first"><span><a href="http://arduino.ru/user/login?destination=node%2F1326%23comment-form">Войдите</a> или <a href="http://arduino.ru/user/register?destination=node%2F1326%23comment-form">зарегистрируйтесь</a>, чтобы получить возможность отправлять комментарии</span></li>
<li class="vud_comment_votes_count last"></li>
</ul>      </div>
      </div>
</div><div class="item-list"><ul class="pager"><li class="pager-current first">1</li>
<li class="pager-item"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01?page=1" title="На страницу номер 2" class="active">2</a></li>
<li class="pager-next"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01?page=1" title="На следующую страницу" class="active">следующая ›</a></li>
<li class="pager-last last"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01?page=1" title="На последнюю страницу" class="active">последняя »</a></li>
</ul></div></div>      </div> <!-- /#main -->

      
       <div class="clear"></div> 
       <div id="push"></div> 
    </div> <!-- /.container -->
    <!-- /layout -->

   <div id="footer" class="clear">
        <div id="block-block-5" class="block block-block">

  
  <div class="content">
        <div style="float: left; margin: 18px 0pt 0pt 18px;">
	Материалы по программированию Arduino переведены с официального сайта проекта Ардуино&nbsp;— <a href="http://arduino.cc/" target="_blank">http://arduino.cc</a><br>
	и представлены по лицензии <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="nofollow" target="_blank">Creative Commons Attribution-ShareAlike 3.0 License</a>.<br>
	Электропочта для связи: <strong> <script language="javascript">
        <!--
        var part1 = "electropochta";
        var part2 = "arduino.ru";
        document.write("<a href=\"mailto:"+ part1 + '@' + part2+"\">"+part1 + '@' + part2+"<\/a>");
        // -->
    </script><a href="mailto:electropochta@arduino.ru">electropochta@arduino.ru</a></strong></div>
  </div>

</div>
              </div> <!-- /#footer -->
  <script type="text/javascript" src="./Передача температуры с датчиков DHT11, DS18B20 через NRF24L01. _ Аппаратная платформа Arduino_files/js_9634bc3f3b3595c3cd0855aaebe5ecdc.js"></script>

  

<div id="lightbox2-overlay" style="display: none;"></div>      <div id="lightbox" style="display: none;" class="lightbox2-orig-layout">        <div id="outerImageContainer" style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);"><div id="modalContainer" style="display: none; padding: 10px;"></div><div id="frameContainer" style="display: none; padding: 10px;"></div><div id="imageContainer" style="display: none; padding: 10px;"><img id="lightboxImage" alt=""><div id="hoverNav"><a id="prevLink" title="Previous" href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#" style="padding-top: 10px;"></a><a id="nextLink" title="Next" href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#" style="padding-top: 10px;"></a></div></div><div id="loading"><a href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#" id="loadingLink"></a></div></div>        <div id="imageDataContainer" class="clearfix" style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">          <div id="imageData"><div id="imageDetails"><span id="caption"></span><span id="numberDisplay"></span></div><div id="bottomNav"><div id="frameHoverNav"><a id="framePrevLink" title="Previous" href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#" style="padding-top: 10px;"></a><a id="frameNextLink" title="Next" href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#" style="padding-top: 10px;"></a></div><a id="bottomNavClose" title="Close" href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#" style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);"></a><a id="bottomNavZoom" href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#"></a><a id="bottomNavZoomOut" href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#"></a><a id="lightshowPause" title="Pause Slideshow" href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#" style="display: none;"></a><a id="lightshowPlay" title="Play Slideshow" href="http://arduino.ru/forum/proekty/peredacha-temperatury-s-datchikov-dht11-ds18b20-cherez-nrf24l01#" style="display: none;"></a></div></div>        </div>      </div><table cellspacing="0" cellpadding="0" class="gstl_50 gssb_c" style="width: 168px; display: none; top: 35px; position: absolute; left: 850px;"><tbody><tr><td class="gssb_f"></td><td class="gssb_e" style="width: 100%;"></td></tr></tbody></table></body></html>